(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const i of d)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function o(d){const i={};return d.integrity&&(i.integrity=d.integrity),d.referrerPolicy&&(i.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?i.credentials="include":d.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(d){if(d.ep)return;d.ep=!0;const i=o(d);fetch(d.href,i)}})();const w=10,Wt=28;let ie=260,ge=620,be=ie-Wt-4,ye=ge+4,Io=be+Wt/2,Po=ye+Wt/2;const c={bypassX:120,bypassW:12,valveX:255,pipeH:20,radStartX:300,radEndX:1540,get secTopY(){return ie},get secBotY(){return ge},collH:Wt,get topCollY(){return be},get botCollY(){return ye},get outletY(){return Io},get inletY(){return Po}},us=45,hs=180;function Fe(t,e,o,a){c.radStartX=o,c.radEndX=c.radStartX+t,c.valveX=o-us,c.bypassX=o-hs,ie=a,ge=ie+e,be=ie-Wt-4,ye=ge+4,Io=be+Wt/2,Po=ye+Wt/2}const ot=4186,gs=.35,ue={T_supply:75,T_room:20,dT_water:10},bs=50,ys=1.3,$t=30,vs=20,ve=10,ws=2,Ts=5,We=1e-7,go=.01,_s=100,Ss=.01,Ms=.05,Cs=1e-8,W={main_pipe:{d_mm:20.4,L_m:2},bypass_pipe:{d_mm:15.6,L_m:1},rad_pipe:{d_mm:20.4,L_m:1.5}},F={ball_valve_34:{zeta_open:.3},ball_valve_12:{zeta_open:.5,zeta_closed:800},tee:{zeta:1.5},radiator:{zeta:3}},at={rho:985,nu:415e-9,g:9.81,lambda:.025},Es=.1,Bs=20.4,Is=50,Ps=10,$s=.2,Ls=4,q={heatLossCoeff:.03,particlesPerLiter:50,gravityForce:.03},qt={activeCount:0,avgTemp:0,bySection:[],coldCount:0,stallCount:0},k=(t,e,o)=>t+(e-t)*o,H=(t,e,o)=>Math.max(e,Math.min(o,t)),$o=(t,e=at.rho)=>t/6e4*e,Lo=(t,e=at.rho)=>t*6e4/e,Fo="radiator_thermal_v1";function dt(t,e,o=20){if(e<=o&&(e=o+1),t<=$t){const a=Math.min(o,$t-1),d=H((t-a)/($t-a),0,1);let i,l,n;if(d<.25){const f=d/.25;i=k(15,25,f),l=k(20,40,f),n=k(100,140,f)}else if(d<.5){const f=(d-.25)/.25;i=k(25,40,f),l=k(40,70,f),n=k(140,185,f)}else if(d<.75){const f=(d-.5)/.25;i=k(40,65,f),l=k(70,115,f),n=k(185,210,f)}else{const f=(d-.75)/.25;i=k(65,100,f),l=k(115,155,f),n=k(210,225,f)}return{r:Math.round(i),g:Math.round(l),b:Math.round(n)}}else{const a=Math.max(e,$t+1),d=H((t-$t)/(a-$t),0,1);let i,l,n;if(d<.2){const f=d/.2;i=k(180,210,f),l=k(130,105,f),n=k(140,110,f)}else if(d<.4){const f=(d-.2)/.2;i=k(210,225,f),l=k(105,80,f),n=k(110,80,f)}else if(d<.6){const f=(d-.4)/.2;i=k(225,230,f),l=k(80,55,f),n=k(80,50,f)}else if(d<.8){const f=(d-.6)/.2;i=k(230,215,f),l=k(55,35,f),n=k(50,35,f)}else{const f=(d-.8)/.2;i=k(215,170,f),l=k(35,15,f),n=k(35,20,f)}return{r:Math.round(i),g:Math.round(l),b:Math.round(n)}}}function ne(t,e,o=1){const a=dt(t,e);return`rgba(${a.r},${a.g},${a.b},${o})`}let Ot,s;function Fs(t){Ot=t;const e=t.getContext("2d");if(!e)throw new Error("2d context not available");s=e}let Q="bad",re=0;function xs(t){re=t}const st=[];let ct=Array(w).fill(1),Tt=100,_t=1240,St=360,Mt=300,Ct=260;function Ue(t){_t=Math.max(400,Math.min(1400,t))}function Je(t){St=Math.max(200,Math.min(600,t))}function Ze(t){Mt=Math.max(285,Math.min(600,t))}function to(t){Ct=Math.max(100,Math.min(400,t))}let ft=0;function eo(t){ft=Math.max(0,Math.min(300,t))}let vt=850;function oo(t){vt=Math.max(700,Math.min(1050,t))}let wt=1600;function so(t){wt=Math.max(1e3,Math.min(2e3,t))}let Dt=1600,Gt=850,Nt=1.15;function no(t){Dt=Math.max(1e3,Math.min(2e3,t))}function ao(t){Gt=Math.max(600,Math.min(1200,t))}function io(t){Nt=Math.max(.8,Math.min(1.5,t))}const X={bypassFrac:.5,radFrac:.5,secFracs:Array(w).fill(.05),bypassLPM:0,radLPM:0};let mt=Array(w).fill(20),nt=!0,Qt=Array(w).fill(20),zt=-1,de=Array(w).fill(0),Ne=Array(w).fill(0),Qe=Array(w).fill(0);const M={hA_section:0,secPowers:Array(w).fill(0),secRetTemps:Array(w).fill(40),secFlowLPM:Array(w).fill(0),secFlowKGS:Array(w).fill(0),secEps:Array(w).fill(0),secNTU:Array(w).fill(0),totalPower:0,avgRetTemp:40,supplyT:70,nomPower:2e3,outsideT:-10,Kroom:20,Qint:0,sysFlowLPM:4,sysFlowKGS:.0667,heatLossDesign:1e3,designOutTemp:-30},z={T_room_eq:20,Q_rad:0,Q_loss:0,iterations:0,converged:!1,log:[],fullLog:[]},xo={bypass_path:{h_total:0,h_friction:0,h_local:0},radiator_path:{h_total:0,h_friction:0,h_local:0},system_total:{h_initial:0,h_current:0,ratio:1},flow:10};let pt=Array(w).fill(!1),Ke=!1,Ro=!1;function lo(t){Ke=t}function ro(t){Ro=t}let Et=Array(ve).fill(!0),At=[100,100,100,100,100,100],qe=null;function xe(t,e){t>=0&&t<6&&(At[t]=Math.max(0,Math.min(100,e)))}function Rs(t){qe=t}let we=!1,Te=!1,_e=!1,Se=!1,ce=!1,Me=!1,Ce=!1,Ee=!1,Be=!1,Ie=!1,Pe=!1,$e=!1,Ht=!0;function ko(t){Q=t}function Yo(t){nt=t}function co(t){zt=t}function po(t){Tt=t}function Ho(t){we=t}function zo(t){Te=t}function Ao(t){_e=t}function Xo(t){Se=t}function Oo(t){ce=t}function Vo(t){Me=t}function Wo(t){Ce=t}function Do(t){Ee=t}function Go(t){Be=t}function No(t){Ie=t}function Qo(t){Pe=t}function Ko(t){$e=t}function je(t){Ht=t}class qo{constructor(){this.temp=70,this.size=2.5,this.speed=5,this.opacity=.9,this.sec=-1,this.x=-20,this.y=c.inletY,this.state="enter",this.path="bypass",this.isCounterflow=!1,this.isCascade=!1,this.counterflowMaxX=0,this.velocityY=0,this.stallCounter=0,this.reset()}reset(){this.temp=M.supplyT??70,this.size=2.5+Math.random()*2,this.speed=5+Math.random()*3,this.opacity=.8+Math.random()*.2,this.sec=-1;const e=ft;e>0&&Math.random()<.4?(this.x=8+(Math.random()-.5)*4,this.y=c.inletY+c.pipeH/2+e-2,this.state="pipe_in"):(this.x=-80-Math.random()*80-e,this.y=c.inletY+(Math.random()-.5)*c.pipeH*.8,this.state="enter"),this.isCounterflow=!1,this.isCascade=!1,this.counterflowMaxX=0,this.velocityY=0,this.stallCounter=0,X.radFrac<.01?this.path="bypass":X.bypassFrac<.01?(this.path="rad",this.pickSec()):Math.random()<X.bypassFrac?this.path="bypass":(this.path="rad",this.pickSec())}pickSec(){const e=Math.random()*X.radFrac;let o=0;for(let a=0;a<w;a++)if(o+=X.secFracs[a],e<=o){this.sec=a;return}this.sec=w-1}secX(e){const o=(c.radEndX-c.radStartX)/w;return c.radStartX+o*e+o/2}decideCollectorDirection(){return Q==="bad"&&nt&&this.sec<=2&&Math.random()<.4?(this.isCounterflow=!0,1):-1}update(){var d;const e=M.supplyT||70,o=z.T_room_eq||10;if(this.state==="rise"&&this.sec>=0&&(this.temp+=((M.secRetTemps[this.sec]||40)-this.temp)*.05),this.state==="top_coll_right"||this.state==="top_coll"){const i=(c.radEndX-c.radStartX)/w,l=H(Math.floor((this.x-c.radStartX)/i),0,w-1),n=Qt[l]||M.avgRetTemp;this.temp+=(n-this.temp)*.03}this.temp=Math.max(this.temp,o);const a=this.temp<(mt[Math.max(0,this.sec)]||e)+2;switch(this.state){case"pipe_in":this.y-=this.speed*.8,this.x=8+Math.sin(this.y*.05)*2,this.y<=c.inletY+c.pipeH/2&&(this.state="enter",this.x=12+(Math.random()-.5)*8,this.y=c.inletY+(Math.random()-.5)*c.pipeH*.8);break;case"enter":this.x+=this.speed,this.y=c.inletY+(Math.random()-.5)*c.pipeH*.6,this.x>=c.bypassX&&(this.path==="bypass"?(this.state="byp_up",this.x=c.bypassX+(Math.random()-.5)*8):this.state="to_rad");break;case"to_rad":this.x+=this.speed,this.y=c.inletY+(Math.random()-.5)*c.pipeH*.6,this.x>=c.radStartX&&(this.state=Q==="good"?"fwd_coll":"to_sec_up",this.y=c.inletY+(Math.random()-.5)*8);break;case"fwd_coll":this.x+=this.speed*1.2,this.y=c.inletY+(Math.random()-.5)*6,this.x>=c.radEndX-30&&(this.state="to_sec_up");break;case"to_sec_up":this.state="rise",this.x=this.secX(this.sec)+(Math.random()-.5)*10,this.y=c.secBotY,this.velocityY=0,this.stallCounter=0;break;case"byp_up":a&&q.gravityForce>0?(this.velocityY+=q.gravityForce,this.y+=this.velocityY,this.stallCounter++,this.stallCounter>60&&(this.state="stall")):(this.velocityY=0,this.y-=this.speed*.7),this.x=c.bypassX+Math.sin(this.y*.08)*3,this.y<=c.outletY&&(this.state="exit");break;case"to_sec":{const i=this.secX(this.sec);this.x+=this.speed*.8,this.y=c.inletY+(Math.random()-.5)*6,this.x>=i-5&&(this.state="rise",this.x=i+(Math.random()-.5)*10,this.y=c.secBotY,this.velocityY=0)}break;case"rise":{const i=Math.max(0,this.sec),l=this.secX(i),n=5,f=(((d=M.secFlowLPM)==null?void 0:d[i])??0)||0,r=Math.max(...M.secFlowLPM||[.1],.001),p=H(f/r,0,1),u=H((this.temp-30)/20,0,1),y=H((c.secBotY-this.y)/(c.secBotY-c.secTopY),0,1),h=this.speed*.5*p,C=this.speed*.3*(u-.3),I=q.gravityForce*(1-u)*(.2+y*1.5),$=h+C;if(f<.01&&u<.1&&q.gravityForce>0){this.velocityY+=q.gravityForce*(.5+y*3),this.velocityY*=.94;const g=this.speed*.05*u;this.y-=g,this.y+=this.velocityY,this.x+=(Math.random()-.5)*.5,q.heatLossCoeff>0&&(this.temp-=q.heatLossCoeff*.5),this.y>=c.secBotY&&(this.y=c.secBotY,this.velocityY=-Math.abs(this.velocityY)*.15,this.stallCounter++,this.stallCounter>4&&(this.state="stall"))}else $<this.speed*.15&&q.gravityForce>0?(this.velocityY+=I,this.velocityY*=.9,this.y-=Math.max($,this.speed*.03),this.y+=this.velocityY*.3,this.x+=(Math.random()-.5)*.4,q.heatLossCoeff>0&&(this.temp-=q.heatLossCoeff*.15),this.y>=c.secBotY&&(this.y=c.secBotY,this.velocityY=0,this.stallCounter++,this.stallCounter>6&&(this.state="stall"))):(this.velocityY=0,this.y-=$,this.x+=(Math.random()-.5)*.3);this.x=H(this.x,l-n,l+n),this.y=H(this.y,c.secTopY,c.secBotY),this.y<=c.secTopY+1&&(this.decideCollectorDirection()>0?(this.state="top_coll_right",this.isCounterflow=!0):this.state="top_coll",this.y=c.outletY+(Math.random()-.5)*c.pipeH*.6,this.stallCounter=0)}break;case"top_coll_right":{const i=(c.radEndX-c.radStartX)/w,l=(this.x-this.secX(this.sec))/i,n=Math.max(.15,1-l*.15);if(this.x+=this.speed*.6*n,this.y=c.outletY+(Math.random()-.5)*c.pipeH*.6,q.heatLossCoeff>0&&(this.temp-=q.heatLossCoeff*.015),this.x>this.counterflowMaxX){this.counterflowMaxX=this.x;const p=Math.floor((this.x-c.radStartX)/i);p<w&&co(Math.max(zt,p))}const f=this.sec+4,r=this.secX(Math.min(f,w-1));this.x>=r&&(this.state="top_coll",this.isCounterflow=!1)}break;case"top_coll":this.x-=this.speed,this.y=c.outletY+(Math.random()-.5)*c.pipeH*.6,this.x<=c.radStartX-10&&(this.state="exit");break;case"stall":if(this.isCascade&&this.sec>=0&&this.sec<w-1&&this.temp>22&&Math.random()<.25){this.sec=this.sec+1,this.state="rise",this.y=c.secBotY,this.velocityY=0,this.stallCounter=0,this.opacity=.7+Math.random()*.2,this.temp-=1;break}this.opacity*=.97,this.opacity<.05&&this.reset();break;case"exit":this.x-=this.speed,this.y=c.outletY+(Math.random()-.5)*c.pipeH*.6,this.x<=12&&ft>0?(this.state="pipe_out",this.x=8+(Math.random()-.5)*4,this.y=c.outletY-c.pipeH/2+2):this.x<-30&&this.reset();break;case"pipe_out":this.y-=this.speed*.8,this.x=8+Math.sin(this.y*.05)*2,this.y<=c.outletY-c.pipeH/2-ft&&this.reset();break}}draw(){s.globalAlpha=this.opacity;let e;this.isCounterflow?e={r:255,g:180,b:0}:this.state==="pipe_out"||this.state==="exit"||this.state==="top_coll"||this.state==="top_coll_right"?e={r:255,g:200,b:80}:e={r:255,g:220,b:50};const o=s.createRadialGradient(this.x,this.y,0,this.x,this.y,this.size);o.addColorStop(0,`rgba(${e.r},${e.g},${e.b},1)`),o.addColorStop(.5,`rgba(${e.r},${e.g},${e.b},0.8)`),o.addColorStop(1,`rgba(${e.r},${e.g},${e.b},0.3)`),s.beginPath(),s.arc(this.x,this.y,this.size,0,Math.PI*2),s.fillStyle=o,s.fill(),s.strokeStyle="rgba(200,150,0,0.5)",s.lineWidth=.5,s.stroke(),this.state==="top_coll_right"&&(s.globalAlpha=this.opacity*.8,s.fillStyle="rgb(255,140,0)",s.beginPath(),s.moveTo(this.x+this.size+3,this.y),s.lineTo(this.x+this.size-1,this.y-4),s.lineTo(this.x+this.size-1,this.y+4),s.closePath(),s.fill()),s.globalAlpha=1}}function Pt(t,e){const o=document.getElementById(t),a=Number((o==null?void 0:o.value)??"");return Number.isFinite(a)?a:e}function ks(){const t=Pt("heatLossDesign",1e3),e=Pt("designOutTemp",-30),o=vs-e;return o<=0?20:t/o}function jo(t){const e=ue.dT_water/(ue.T_supply-ue.T_room),o=-Math.log(1-e),a=t/(ot*ue.dT_water);return o*a*ot}function De(t,e,o,a,d){const i=[],l=[],n=[],f=[],r=[],p=[];let m=0,u=0,y=0,h=0;for(let g=0;g<w;g++){let b=o*X.secFracs[g],B=Lo(b),_=0,E=e,P=0,v=0;if(pt[g]){const S=o*X.secFracs[g];if(S>We&&ct[g]>go&&e>t+.5){const Y=a*ct[g]/(S*ot),O=(1-Math.exp(-Y))*S*ot*(e-t);e-O/(S*ot)>Ts?pt[g]=!1:(b=0,B=0,_=0,E=Math.min(t,0),h++)}else b=0,B=0,_=0,E=Math.min(t,0),h++}if(!pt[g]&&b>We&&ct[g]>go&&e>t+.5){v=a*ct[g]/(b*ot),P=1-Math.exp(-v),_=P*b*ot*(e-t),E=e-_/(b*ot),E=H(E,t,e);const T=(e+E)/2-t,Y=T>1?Math.pow(T/bs,ys-1):0;_*=H(Y,.3,1.5),_=Math.min(_,d*1.5),E=e-_/(b*ot),E=H(E,t,e),E<=ws&&(pt[g]=!0,b=0,B=0,_=0,E=0,h++,Ro||(console.error(`üö® –ê–í–ê–†–ò–Ø! –°–µ–∫—Ü–∏—è ‚Ññ${g+1} –ó–ê–ú–ï–†–ó–õ–ê!`),ro(!0),setTimeout(()=>{var A;if(confirm(`üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ê–í–ê–†–ò–Ø!

–°–µ–∫—Ü–∏—è ‚Ññ${g+1} –ó–ê–ú–ï–†–ó–õ–ê –ø—Ä–∏ T=${E.toFixed(1)}¬∞C
–û–±—Ä–∞–∑–æ–≤–∞–ª–∞—Å—å –ª–µ–¥—è–Ω–∞—è –ø—Ä–æ–±–∫–∞!

–¶–∏—Ä–∫—É–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –î–∞–≤–ª–µ–Ω–∏–µ –ª—å–¥–∞ —Ä–∞–∑–æ—Ä–≤—ë—Ç —Ä–∞–¥–∏–∞—Ç–æ—Ä!

–ù–∞–∂–º–∏—Ç–µ OK –¥–ª—è –∞–≤–∞—Ä–∏–π–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã.`)){const O=document.getElementById("systemFlow");O&&(O.value="0"),(A=window.recalcAll)==null||A.call(window)}},100)))}i.push(_),l.push(E),n.push(B),f.push(b),r.push(P),p.push(v),m+=_,b>We&&(u+=E*b,y+=b)}h>=w*.3&&lo(!0);const C=y>0?u/y:e,I=o*X.bypassFrac,$=y+I>0?(C*y+e*I)/(y+I):e;return{totalPower:m,secPowers:i,secRetTemps:l,secFlowLPM:n,secFlowKGS:f,secEps:r,secNTU:p,avgRetTemp:$,frozenCount:h}}function Ys(t){const e=M.supplyT||70,o=z.T_room_eq||20;M.outsideT;const a=(M.nomPower||2e3)/w,d=M.secPowers[t]||0,i=M.secRetTemps[t]||e,l=M.secFlowLPM[t]||0,n=z.Q_loss||0,f=M.totalPower||0;if(pt[t])return Math.min(o,0);if(l<.001||d<a*.05)return o;const r=(e+i)/2,p=H(d/a,0,1);let m=H(k(o,r,Math.pow(p,.6)),o,e);const u=n/Math.max(f,1);if(o<18){const y=H((18-o)/20,0,.6);m=k(m,o,y)}if(u>.95){const y=H((u-.95)/.05,0,.3);m=k(m,o,y)}return t<2&&!pt[t]&&(m=k(m,e,$s)),t>=3&&!pt[t]&&(m=Math.max(o,m-Ls)),H(m,o,e)}function Hs(){for(let t=0;t<w;t++)mt[t]=Ys(t)}function zs(){M.supplyT;const t=z.T_room_eq||20,e=M.secFlowKGS.slice(),o=M.secRetTemps.slice(),a=[];if(Q==="bad"&&nt){const d=zt>=0?zt:4;let i=0,l=0;for(let m=0;m<Math.min(3,w);m++){const u=e[m]||0,y=o[m]||t;u>1e-8&&(i+=u,l+=u*y)}const n=i>1e-8?l/i:t,r=i*.3,p=.055;for(let m=0;m<w;m++)if(m<=d&&i>1e-8){const u=Math.max(0,m),y=r>1e-8?p*(n-t)/(r*ot):0,h=n-u*y;a.push(Math.max(h,t))}else a.push(mt[m]||t)}else if(Q==="bad"&&!nt)for(let d=0;d<w;d++)a.push(mt[d]||t);else{let d=0,i=0;for(let n=w-1;n>=0;n--){const f=e[n]||0,r=o[n]||t;d+=f,i+=f*r}const l=d>1e-8?i/d:t;for(let n=0;n<w;n++)a.push(l)}for(let d=0;d<w;d++)Qt[d]=a[d]}function As(){const t=Pt("nominalPower",2e3),e=Pt("outsideTemp",-10),o=ks(),a=Pt("internalGains",0),d=Pt("systemFlow",4),i=$o(d),l=Pt("supplyTemp",70),n=t/w,f=jo(n),r=Pt("heatLossDesign",1e3),p=Pt("designOutTemp",-30);z.log=[],z.fullLog=[];let m=20,u=!1,y=0;for(y=0;y<_s;y++){const I=De(m,l,i,f,n).totalPower,$=o*(m-e)-a,g=I-$;if(z.log.push({iter:y+1,T_room:m,Q_rad:I,Q_loss:$,f:g}),z.fullLog.push({iter:y+1,T_room:m,Q_rad:I,Q_loss:$,f:g}),Math.abs(g)<Ss){u=!0;break}const b=Ms,B=De(m+b,l,i,f,n),_=o*(m+b-e)-a,E=(B.totalPower-_-g)/b;if(Math.abs(E)<Cs)break;const P=H(-g/E,-3,3);m=H(m+P,e+1,l-.5)}m=H(m,e+1,50);const h=De(m,l,i,f,n);z.T_room_eq=m,z.Q_rad=h.totalPower,z.Q_loss=o*(m-e)-a,z.iterations=y+1,z.converged=u,Object.assign(M,{hA_section:f,secPowers:h.secPowers,secRetTemps:h.secRetTemps,secFlowLPM:h.secFlowLPM,secFlowKGS:h.secFlowKGS,secEps:h.secEps,secNTU:h.secNTU,totalPower:h.totalPower,avgRetTemp:h.avgRetTemp,supplyT:l,nomPower:t,outsideT:e,Kroom:o,Qint:a,sysFlowLPM:d,sysFlowKGS:i,heatLossDesign:r,designOutTemp:p}),Hs(),zs()}function Uo(t,e){const o=document.getElementById(t);return parseFloat((o==null?void 0:o.value)||"")||e}function Jo(t,e){if(t<1)return .1;const a=15e-5/e;function d(f){const r=a/3.7,p=5.74/Math.pow(f,.9),m=-2*Math.log10(r+p);return H(1/(m*m),.008,.1)}if(t<=2320)return 64/t;if(t>=4e3)return d(t);const i=64/2320,l=d(4e3),n=(t-2320)/1680;return k(i,l,n)}function se(t,e,o,a){if(t<=.001)return{h_friction:0,h_local:0,h_total:0,velocity:0,Re:0,lambda:0};e=Math.max(e,.1);const d=t/6e4,i=e/1e3,l=Math.PI*i*i/4,n=d/l,f=n*i/at.nu,r=Jo(f,i),p=at.rho*n*n/2,m=r*(o/i)*p,u=a*p,y=m/(at.rho*at.g),h=u/(at.rho*at.g);return{h_friction:y,h_local:h,h_total:y+h,velocity:n,Re:f,lambda:r}}function Xs(){const t=Uo("systemFlow",4),e=X.bypassLPM,o=X.radLPM,a=Tt/100,d=Math.log(F.ball_valve_12.zeta_closed/F.ball_valve_12.zeta_open),i=F.ball_valve_12.zeta_open*Math.exp(d*(1-a)),l=F.tee.zeta+i+F.tee.zeta,n=F.tee.zeta+F.ball_valve_34.zeta_open+F.radiator.zeta+F.ball_valve_34.zeta_open+F.tee.zeta,f=se(e,W.bypass_pipe.d_mm,W.bypass_pipe.L_m,l),r=se(o,W.rad_pipe.d_mm,W.rad_pipe.L_m,n),p=se(t,W.main_pipe.d_mm,W.main_pipe.L_m,0),m=(f.h_total+r.h_total)/2,u=p.h_total+m,y=F.tee.zeta+F.ball_valve_12.zeta_open+F.tee.zeta,h=W.bypass_pipe.d_mm/1e3,C=W.rad_pipe.d_mm/1e3,I=Math.PI*h*h/4,$=Math.PI*C*C/4,g=I/Math.sqrt(Math.max(y,.01)),b=$/Math.sqrt(Math.max(n,.01)),B=g+b,_=B>1e-12?g/B:.5,E=se(t*_,W.bypass_pipe.d_mm,W.bypass_pipe.L_m,y),P=se(t*(1-_),W.rad_pipe.d_mm,W.rad_pipe.L_m,n),v=(E.h_total+P.h_total)/2,S=p.h_total+v;Object.assign(xo,{bypass_path:{h_total:f.h_total,h_friction:f.h_friction,h_local:f.h_local,velocity:f.velocity,flow:e,Re:f.Re,lambda:f.lambda},radiator_path:{h_total:r.h_total,h_friction:r.h_friction,h_local:r.h_local,velocity:r.velocity,flow:o,Re:r.Re,lambda:r.lambda},system_total:{h_initial:S,h_current:u,ratio:u/(S>.001?S:1),main_before:p.h_total,main_after:0},flow:t})}function Os(){const t=Uo("systemFlow",4),e=Tt/100,o=F.ball_valve_12.zeta_open,a=F.ball_valve_12.zeta_closed,d=Math.log(a/o),i=o*Math.exp(d*(1-e)),l=F.tee.zeta+i+F.tee.zeta,n=ct.reduce((b,B)=>b+B,0)/w,f=F.tee.zeta+F.ball_valve_34.zeta_open+F.radiator.zeta+F.ball_valve_34.zeta_open+F.tee.zeta,r=f/Math.max(Math.pow(H(n,.01,1),.6),.01),p=W.bypass_pipe.d_mm/1e3,m=W.rad_pipe.d_mm/1e3,u=Math.PI*p*p/4,y=Math.PI*m*m/4,h=u/Math.sqrt(Math.max(l,.01)),C=y/Math.sqrt(Math.max(r,.01)),I=h+C;e<.01?(X.bypassFrac=0,X.radFrac=1):(X.bypassFrac=I>1e-12?h/I:0,X.radFrac=I>1e-12?C/I:0),X.bypassLPM=t*X.bypassFrac,X.radLPM=t*X.radFrac;const $=X.radFrac;let g;if(X.bypassFrac>.01){const b=Is/100,B=Ps/100,_=1-b-B,E=Math.max(w-3,1);g=[];for(let v=0;v<w;v++){let S;v<2?S=b/2*$:v===2?S=B*$:S=_/E*$,g.push(S*H(ct[v],.01,1))}const P=g.reduce((v,S)=>v+S,0);if(P>1e-12)for(let v=0;v<w;v++)g[v]=g[v]/P*$}else{const b=Bs/1e3,B=Math.PI*b*b/4,_=.025,E=[];let P=0;for(let v=0;v<w;v++){const S=H(ct[v],.01,1),T=f/Math.pow(S,.6),Y=Es*v,A=Y>0?_*(Y/b):0,O=T+A,K=B/Math.sqrt(Math.max(O,.01));E.push(K),P+=K}g=P>1e-12?E.map(v=>v/P*$):Array(w).fill($/w)}X.secFracs=g,Xs()}function Bt(){var Jt,pe,bt,Zt,fe,me;const t=parseFloat(((Jt=document.getElementById("riser-supply-temp"))==null?void 0:Jt.value)||"")||80,e=parseFloat(((pe=document.getElementById("riser-flow"))==null?void 0:pe.value)||"")||6,o=parseFloat(((bt=document.getElementById("riser-rad-power"))==null?void 0:bt.value)||"")||1500,a=parseFloat(((Zt=document.getElementById("riser-room-temp"))==null?void 0:Zt.value)||"")||20,d=parseFloat(((fe=document.getElementById("riser-pipe-d"))==null?void 0:fe.value)||"")||25.4,i=parseFloat(((me=document.getElementById("riser-bypass-d"))==null?void 0:me.value)||"")||20.4,l=W.rad_pipe.d_mm,n=ve,f=F.tee.zeta+F.ball_valve_12.zeta_open+F.tee.zeta,r=F.tee.zeta+F.ball_valve_34.zeta_open+F.radiator.zeta+F.ball_valve_34.zeta_open+F.tee.zeta,p=3,m=Math.log(F.ball_valve_12.zeta_closed/F.ball_valve_12.zeta_open);function u(U){const It=Math.max(0,Math.min(100,U)),ht=F.ball_valve_12.zeta_open*Math.exp(m*(1-It/100));return F.tee.zeta+ht+F.tee.zeta}const y=e/6e4,h=d/1e3,C=Math.PI*h*h/4,$=(C>0?y/C:.5)*h/at.nu,g=Jo($,h),b=Math.PI*Math.pow(d/2e3,2),B=Math.PI*Math.pow(i/2e3,2),_=Math.PI*Math.pow(l/2e3,2),E=B/Math.sqrt(Math.max(f,.01)),P=_/Math.sqrt(Math.max(r,.01));let v=0,S=0,T=0;for(let U=0;U<n;U++){const It=g*(p/h);let ht,Kt;if(U<6){const it=At[U];Kt=it>=5;const Lt=u(it);ht=B/Math.sqrt(Math.max(Lt,.01))}else Kt=Et[U],ht=Kt?E:0;const Ae=b*b/Math.pow(ht+P,2);if(v+=b*b/Math.pow(E+P,2)+It,Kt)S+=Ae+It;else{const it=r*Math.pow(b/_,2);S+=it+It,T++}}const Y=Math.sqrt(v/S),A=e*Y,O=$o(A),K=(1-Y)*100,V=o,D=jo(V),ut=10,Z=[];let L=t;for(let U=0;U<n;U++){let It,ht;if(U<6){const ho=At[U];ht=ho>=5;const ms=u(ho);It=B/Math.sqrt(Math.max(ms,.01))}else ht=Et[U],It=ht?E:0;const Kt=Math.ceil((n-U)/2),Ae=(n-U)%2===0;let it;ht?(it=P/(P+It),it=H(it,.05,.95)):it=1;const Lt=O*it,cs=Lo(Lt);let te=0,ee=L,Xe=0,Oe=0;Lt>1e-7&&L>a+.5&&(Oe=D/(Lt*ot),Xe=1-Math.exp(-Oe),te=Xe*Lt*ot*(L-a),te=Math.min(te,V*1.5),ee=L-te/(Lt*ot),ee=H(ee,a,L));const ps=O*(1-it);let oe;O>1e-7?oe=(ee*Lt+L*ps)/O:oe=L;const fs=ut*Math.PI*h*p*(oe-a),uo=O>1e-7?fs/(O*ot):0,Ve=oe-H(uo,0,oe-a);Z.push({index:U,floor:Kt,isSecondOnFloor:Ae,bypassOpen:ht,Tin:L,Tout:Ve,Tout_rad:ee,Q:te,eps:Xe,ntu:Oe,radFlowLPM:cs,radFlowFraction:it,totalFlowLPM:A,deltaT:L-Ve,pipeLoss:uo}),L=Ve}const j=Z[n-1].Tout,tt=t-j;Rs({floors:Z,supplyTemp:t,returnTemp:j,totalDeltaT:tt,baseFlowLPM:e,actualFlowLPM:A,flowDropPercent:K,closedCount:T,flowRatio:Y}),Ns()}function Vs(){var t;Et.fill(!0),Bt(),(t=window.saveSettings)==null||t.call(window)}function Ws(){var t;Et.fill(!1),Bt(),(t=window.saveSettings)==null||t.call(window)}function Ds(){var t;Et.fill(!0),Et[0]=!1,Bt(),(t=window.saveSettings)==null||t.call(window)}function Gs(t){var e;Et[t]=!Et[t],Bt(),(e=window.saveSettings)==null||e.call(window)}function Ns(){if(!qe)return;const t=qe,e=document.getElementById("riser-total-flow"),o=document.getElementById("riser-delta-t"),a=document.getElementById("riser-flow-drop"),d=document.getElementById("riser-return-temp");e&&(e.textContent=t.actualFlowLPM.toFixed(2)),o&&(o.textContent=t.totalDeltaT.toFixed(1)),a&&(a.textContent=t.flowDropPercent.toFixed(1)),d&&(d.textContent=t.returnTemp.toFixed(1));const i=document.getElementById("riser-floors-container");let l="";const n=t.supplyTemp;for(let m=0;m<t.floors.length;m++){const u=t.floors[m],y=u.isSecondOnFloor?`${u.floor}—ç (–±)`:`${u.floor}—ç (–∞)`,h=H((u.Tin-20)/(n-20)*100,5,100),C=dt(u.Tin,n,20),I=dt(u.Tout,n,20),$=u.bypassOpen?"rgba(220,252,231,0.5)":"rgba(254,226,226,0.5)",g=u.Tin>50?"üî•":u.Tin>35?"üå°":"‚ùÑÔ∏è";l+=`<div class="riser-floor-row" style="background:${$}">
   <div class="flex items-center gap-2">
    <div class="riser-floor-indicator" style="background:rgb(${C.r},${C.g},${C.b})">${m+1}</div>
    <span class="text-xs font-bold">${y}</span>
   </div>
   <div>
    <div class="flex items-center gap-2">
     <span class="font-bold" style="color:rgb(${C.r},${C.g},${C.b})">${u.Tin.toFixed(1)}¬∞</span>
     <span class="text-slate-400">‚Üí</span>
     <span class="font-bold" style="color:rgb(${I.r},${I.g},${I.b})">${u.Tout.toFixed(1)}¬∞</span>
     <span class="text-xs text-slate-500">(ŒîT=${u.deltaT.toFixed(1)}¬∞)</span>
    </div>
    <div class="riser-temp-bar mt-1" style="background:#e5e7eb">
     <div class="riser-temp-bar-fill" style="width:${h}%;background:linear-gradient(90deg,rgb(${I.r},${I.g},${I.b}),rgb(${C.r},${C.g},${C.b}))"></div>
    </div>
   </div>
   <div class="text-center">
    <div class="font-bold text-sky-700">${u.radFlowLPM.toFixed(2)}</div>
    <div class="text-xs text-slate-500">${(u.radFlowFraction*100).toFixed(0)}% —Ä–∞–¥</div>
   </div>
   <div class="text-center">
    <div class="font-bold text-orange-700">${u.Q.toFixed(0)} –í—Ç</div>
    <div class="text-xs text-slate-500">Œµ=${(u.eps*100).toFixed(0)}%</div>
   </div>
   <div class="text-center">
    <button class="riser-bypass-toggle ${u.bypassOpen?"open":"closed"}" onclick="toggleRiserBypass(${m})" title="${u.bypassOpen?"–û—Ç–∫—Ä—ã—Ç–∞ ‚Äî –Ω–∞–∂–º–∏ –∑–∞–∫—Ä—ã—Ç—å":"–ó–∞–∫—Ä—ã—Ç–∞ ‚Äî –Ω–∞–∂–º–∏ –æ—Ç–∫—Ä—ã—Ç—å"}"></button>
    <div class="text-xs mt-1 ${u.bypassOpen?"text-green-600":"text-red-600"}">${u.bypassOpen?"–û—Ç–∫—Ä.":"–ó–∞–∫—Ä."}</div>
   </div>
   <div class="text-center text-lg">${g}</div>
  </div>`}i&&(i.innerHTML=l);const f=document.getElementById("riser-verdict"),r=t.floors[t.floors.length-1],p=t.supplyTemp-r.Tin;if(t.closedCount>0){let m=`<div class="riser-warning">
   <div class="text-sm font-bold text-red-800 mb-2">‚ö† –í–ù–ò–ú–ê–ù–ò–ï: ${t.closedCount} –ø–µ—Ä–µ–º—ã—á–µ–∫ –∑–∞–∫—Ä—ã—Ç–æ!</div>
   <div class="text-xs text-red-700">
   <p>üîß <strong>–†–∞—Å—Ö–æ–¥ —É–ø–∞–ª –Ω–∞ ${t.flowDropPercent.toFixed(1)}%</strong> (–±—ã–ª–æ ${t.baseFlowLPM.toFixed(1)} ‚Üí —Å—Ç–∞–ª–æ ${t.actualFlowLPM.toFixed(2)} –ª/–º–∏–Ω)</p>
   <p>üå° <strong>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ –≤—Ö–æ–¥–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–∞–¥–∏–∞—Ç–æ—Ä–∞: ${r.Tin.toFixed(1)}¬∞C</strong> (–ø–æ–¥–∞—á–∞ –±—ã–ª–∞ ${t.supplyTemp}¬∞C, –ø–æ—Ç–µ—Ä—è–Ω–æ ${p.toFixed(1)}¬∞C)</p>
   <p>‚ùÑÔ∏è –ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–¥–∏–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –≤–æ–¥—É –Ω–∞ <strong>${p.toFixed(1)}¬∞C —Ö–æ–ª–æ–¥–Ω–µ–µ</strong> —á–µ–º –ø–µ—Ä–≤—ã–π</p>`;r.Tin<40&&(m+='<p class="mt-2 font-bold text-red-900">üö® –ö–†–ò–¢–ò–ß–ù–û: –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∏–∂–µ 40¬∞C ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞–¥–∏–∞—Ç–æ—Ä—ã –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –≥—Ä–µ—é—Ç!</p>'),m+="</div></div>",f&&(f.innerHTML=m)}else f&&(f.innerHTML=`<div class="riser-ok">
   <div class="text-sm font-bold text-green-800 mb-1">‚úÖ –í—Å–µ –ø–µ—Ä–µ–º—ã—á–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</div>
   <div class="text-xs text-green-700">
   <p>–†–∞—Å—Ö–æ–¥ —Å—Ç–æ—è–∫–∞: ${t.actualFlowLPM.toFixed(2)} –ª/–º–∏–Ω</p>
   <p>–ü–µ—Ä–µ–ø–∞–¥ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –ø–æ —Å—Ç–æ—è–∫—É: ${t.totalDeltaT.toFixed(1)}¬∞C (${t.supplyTemp}¬∞ ‚Üí ${t.returnTemp.toFixed(1)}¬∞)</p>
   <p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–¥–∏–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –≤–æ–¥—É ${r.Tin.toFixed(1)}¬∞C (–Ω–∞ ${p.toFixed(1)}¬∞C —Ö–æ–ª–æ–¥–Ω–µ–µ –ø–µ—Ä–≤–æ–≥–æ)</p>
   </div>
  </div>`)}const rt=t=>Math.round(Number(t)*2)/2;function J(){return Nt}const Le=2,bo=3,Qs=6;function Re(){return Math.round(81*J())}function ke(){return Math.round(978*J())}const N=8,lt=5;function yo(){return Math.round(196*J())}function Ye(){return Math.round(115*J())}function He(){return Math.round(184*J())}function ze(){return Math.round(150*J())}function Ks(){const t=Re(),e=ke(),o=e-t;return[Math.round(t+o*.28),Math.round(t+o*.72)]}function qs(){return Math.round(1200*J())}function Zo(){return Math.round(700*J())}function jt(){return Math.round(50*J())}function ae(){return Zo()-Math.round(35*J())}function ts(){return ze()+2*He()}function es(){return ze()+1*He()}function os(){return ze()+0*He()}function js(){return ts()-1}function Us(){return ts()+Ye()+7}function Js(){return es()-4+3}function Zs(){return es()+Ye()+4+3}function Vt(){return os()-4+3}function tn(){return os()+Ye()+4+3}const fo=10,ss=14;function Ft(){return tn()-fo}function xt(){return Zs()-fo}function Rt(){return Us()-fo}function kt(){return Js()+ss}function Yt(){return js()+ss}const x=4;function vo(){return Vt()+14}const wo=10;function To(){return Math.round(22*J())}function et(t,e,o,a,d){if(a<=0||d<=0)return;const i=rt(e),l=rt(o),n=rt(a),f=rt(d),r=Math.min(n,f)/2,p=Math.min(r,n/2,f/2),m=n>=f;t.beginPath(),t.moveTo(i+p,l),t.lineTo(i+n-p,l),t.arcTo(i+n,l,i+n,l+p,p),t.lineTo(i+n,l+f-p),t.arcTo(i+n,l+f,i+n-p,l+f,p),t.lineTo(i+p,l+f),t.arcTo(i,l+f,i,l+f-p,p),t.lineTo(i,l+p),t.arcTo(i,l,i+p,l,p),t.closePath();const u=m?t.createLinearGradient(i,l,i,l+f):t.createLinearGradient(i,l,i+n,l);u.addColorStop(0,"rgba(65,  90,  115, 1)"),u.addColorStop(.18,"rgba(155, 180, 205, 1)"),u.addColorStop(.4,"rgba(235, 248, 255, 1)"),u.addColorStop(.57,"rgba(195, 218, 235, 1)"),u.addColorStop(.8,"rgba(140, 165, 190, 1)"),u.addColorStop(1,"rgba(65,  90,  115, 1)"),t.fillStyle=u,t.fill(),t.beginPath(),t.moveTo(i+p,l),t.lineTo(i+n-p,l),t.arcTo(i+n,l,i+n,l+p,p),t.lineTo(i+n,l+f-p),t.arcTo(i+n,l+f,i+n-p,l+f,p),t.lineTo(i+p,l+f),t.arcTo(i,l+f,i,l+f-p,p),t.lineTo(i,l+p),t.arcTo(i,l,i+p,l,p),t.closePath(),t.strokeStyle="rgba(50, 75, 100, 0.5)",t.lineWidth=1,t.stroke()}function en(t){const e=Re(),o=ke(),a=N*2,d=()=>{t.beginPath(),t.moveTo(e,vo()),t.lineTo(e,jt()+a),t.arcTo(e,jt(),e+a,jt(),a),t.lineTo(o-a,jt()),t.arcTo(o,jt(),o,jt()+a,a),t.lineTo(o,vo())};t.save(),t.lineCap="round",t.lineJoin="round",d(),t.strokeStyle="rgb(52, 74, 98)",t.lineWidth=N,t.stroke(),d(),t.strokeStyle="rgb(148, 175, 202)",t.lineWidth=N*.72,t.stroke(),d(),t.strokeStyle="rgba(232, 247, 255, 0.92)",t.lineWidth=N*.3,t.stroke(),t.restore()}function _o(t,e,o,a,d){const i=rt(e),l=rt(o),n=8,f=a>=50,r=f?"rgba(74, 222, 128, 0.95)":"rgba(248, 113, 113, 0.95)";t.save(),t.lineJoin="round",t.lineCap="round",t.fillStyle="rgba(0,0,0,0.18)",t.beginPath(),t.moveTo(i-n+1.5,l-n+1.5),t.lineTo(i+1.5,l+1.5),t.lineTo(i+n+1.5,l-n+1.5),t.lineTo(i+n+1.5,l+n+1.5),t.lineTo(i+1.5,l+1.5),t.lineTo(i-n+1.5,l+n+1.5),t.closePath(),t.fill(),t.fillStyle=r,t.strokeStyle="#1e293b",t.lineWidth=1.5,t.beginPath(),t.moveTo(i-n,l-n),t.lineTo(i,l),t.lineTo(i-n,l+n),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(i+n,l-n),t.lineTo(i,l),t.lineTo(i+n,l+n),t.closePath(),t.fill(),t.stroke(),t.strokeStyle="#1e293b",t.lineWidth=1.5,t.beginPath(),t.moveTo(i-n,l),t.lineTo(i+n,l),t.stroke(),t.strokeStyle="#1e293b",t.lineWidth=2,f?(t.beginPath(),t.moveTo(i,l-n-2),t.lineTo(i,l-n-8),t.stroke(),t.beginPath(),t.moveTo(i-4,l-n-8),t.lineTo(i+4,l-n-8),t.stroke()):(t.beginPath(),t.moveTo(i+n+2,l),t.lineTo(i+n+8,l),t.stroke(),t.beginPath(),t.moveTo(i+n+8,l-4),t.lineTo(i+n+8,l+4),t.stroke()),t.restore()}function So(t,e,o){const a=[[Vt(),Ft()+x],[kt()-x,xt()+x],[Yt()-x,Rt()+x]],d=o==="left"?-Math.PI/2:Math.PI/2,i=o==="left"?e-To():e+To();t.fillStyle="#1e293b",t.font="bold 11px Inter",t.textAlign="center",t.textBaseline="middle";for(const[p,m]of a)t.save(),t.translate(i,(p+m)/2),t.rotate(d),t.fillText("1/2",0,0),t.restore();t.save();const l=ae()+Math.round(6*J()),n=e+N/2+Math.round(18*J()),f=Math.round(25*J()),r=rt(l+(o==="left"?4/3:-4/3));t.font="bold 14px Inter",t.textAlign=o==="left"?"left":"right",t.textBaseline="middle",t.fillText("—Å—Ç–æ—è–∫ 3/4",o==="left"?n+f:n-f,r),t.restore()}function on(t){const e=Re(),o=ke();et(t,e-lt/2,Vt(),lt,Ft()-Vt()+x),et(t,o-lt/2,Vt(),lt,Ft()-Vt()+x),en(t),et(t,e-N/2,Ft()-x,N,kt()-(Ft()-x)),et(t,e-lt/2,kt()-x,lt,xt()-(kt()-x)+x),et(t,e-N/2,xt()-x,N,Yt()-(xt()-x)),et(t,e-lt/2,Yt()-x,lt,Rt()-(Yt()-x)+x),et(t,e-N/2,Rt()-x,N,ae()-(Rt()-x)),So(t,e,"left");const a=[[Vt(),Ft()+x],[kt()-x,xt()+x],[Yt()-x,Rt()+x]];for(let f=0;f<3;f++){const r=(a[f][0]+a[f][1])/2;_o(t,e,r,At[2-f])}const d=e+N/2+Math.round(18*J()),i=ae()+Math.round(6*J());t.fillStyle="#1e293b",t.strokeStyle="#1e293b",t.lineWidth=1,t.beginPath(),t.moveTo(d,i-12),t.lineTo(d-8,i+8),t.lineTo(d+8,i+8),t.closePath(),t.fill(),t.stroke(),et(t,o-N/2,Ft()-x,N,kt()-(Ft()-x)),et(t,o-lt/2,kt()-x,lt,xt()-(kt()-x)+x),et(t,o-N/2,xt()-x,N,Yt()-(xt()-x)),et(t,o-lt/2,Yt()-x,lt,Rt()-(Yt()-x)+x),et(t,o-N/2,Rt()-x,N,ae()-(Rt()-x)),So(t,o,"right");for(let f=0;f<3;f++){const r=(a[f][0]+a[f][1])/2;_o(t,o,r,At[5-f])}const l=o+N/2+Math.round(18*J()),n=ae()+Math.round(6*J());t.fillStyle="#1e293b",t.strokeStyle="#1e293b",t.beginPath(),t.moveTo(l,n+12),t.lineTo(l-8,n-8),t.lineTo(l+8,n-8),t.closePath(),t.fill(),t.stroke()}function Xt(t,e,o,a,d,i){if(typeof t.roundRect=="function")t.roundRect(e,o,a,d,i);else{const n=Math.min(i,a/2,d/2);t.moveTo(e+n,o),t.lineTo(e+a-n,o),t.arcTo(e+a,o,e+a,o+n,n),t.lineTo(e+a,o+d-n),t.arcTo(e+a,o+d,e+a-n,o+d,n),t.lineTo(e+n,o+d),t.arcTo(e,o+d,e,o+d-n,n),t.lineTo(e,o+n),t.arcTo(e,o,e+n,o,n),t.closePath()}}function sn(t,e,o,a,d,i){const l=rt(e),n=rt(o),f=rt(a),r=rt(d),p=M.supplyT||70,m=70-i*4,u=dt(m,p,20);t.fillStyle="rgba(0,0,0,0.1)",t.fillRect(l+3,n+3,f,r);const y=t.createLinearGradient(l,0,l+f,0);y.addColorStop(0,`rgba(${Math.max(u.r-30,0)},${Math.max(u.g-30,0)},${Math.max(u.b-30,0)},1)`),y.addColorStop(.5,`rgba(${Math.min(u.r+60,255)},${Math.min(u.g+60,255)},${Math.min(u.b+60,255)},1)`),y.addColorStop(1,`rgba(${Math.max(u.r-30,0)},${Math.max(u.g-30,0)},${Math.max(u.b-30,0)},1)`),t.fillStyle=y,t.beginPath(),Xt(t,l,n,f,r,4),t.fill();const h=8,C=f/(h+1);t.strokeStyle=`rgba(${Math.max(u.r-60,0)},${Math.max(u.g-60,0)},${Math.max(u.b-60,0)},0.25)`;for(let Z=1;Z<=h;Z++){const L=l+Z*C;t.beginPath(),t.moveTo(L,n+2),t.lineTo(L,n+r-2),t.stroke()}const I=i%Le,$=Math.floor(i/Le),g=I===0?bo-$:bo+$+1,b=N,B=n-2,_=n+r,E=6,P=2;t.fillStyle="rgba(0,0,0,0.08)",t.beginPath(),Xt(t,l-2,B-2,f+4,E+4,P),t.fill(),t.fillStyle="rgba(50,50,220,0.35)",t.beginPath(),Xt(t,l,B,f,E,P),t.fill(),t.strokeStyle="#94a3b8",t.lineWidth=1,t.beginPath(),Xt(t,l,B,f,E,P),t.stroke(),t.fillStyle="rgba(0,0,0,0.08)",t.beginPath(),Xt(t,l-2,_-2,f+4,E+4,P),t.fill(),t.fillStyle="rgba(220,50,50,0.35)",t.beginPath(),Xt(t,l,_,f,E,P),t.fill(),t.strokeStyle="#94a3b8",t.lineWidth=1,t.beginPath(),Xt(t,l,_,f,E,P),t.stroke();const v=g===1||g===2||g===3,S=v?Re():ke(),T=v?l-wo:l+f+wo,Y=8,A=v?S:T+Y,K=(v?T-Y:S)-A,V=B+E/2,D=_+E/2;et(t,A,V-b/2,K,b),et(t,A,D-b/2,K,b),t.strokeStyle="#1e293b",t.lineWidth=2,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(T,V),t.lineTo(T-8,V-6),t.lineTo(T-8,V+6),t.closePath(),t.moveTo(T,V),t.lineTo(T+8,V-6),t.lineTo(T+8,V+6),t.closePath(),t.moveTo(T,V),t.lineTo(T,V-8),t.moveTo(T-4,V-8),t.lineTo(T+4,V-8),t.stroke(),t.beginPath(),t.moveTo(T,D),t.lineTo(T-8,D-6),t.lineTo(T-8,D+6),t.closePath(),t.moveTo(T,D),t.lineTo(T+8,D-6),t.lineTo(T+8,D+6),t.closePath(),t.moveTo(T,D),t.lineTo(T,D-8),t.moveTo(T-4,D-8),t.lineTo(T+4,D-8),t.stroke();const ut=rt(A+K/2);t.fillStyle="#1e293b",t.font="bold 11px Inter",t.fillText("3/4",ut,V+b/2+12),t.fillText("3/4",ut,D-b/2-10),t.font="bold 18px Inter",t.fillStyle="#1e293b",t.textAlign="center",t.textBaseline="middle",t.fillText(`${g}`,l+f/2,n-8)}function nn(t,e,o,a){const d=o-a,i=qs(),l=Zo(),n=Math.min(e/i,d/l),f=(e-i*n)/2,r=a+(d-l*n)/2;t.save(),t.translate(f,r),t.scale(n,n),on(t);const p=Ks();for(let m=0;m<Qs;m++){const u=m%Le,y=Math.floor(m/Le),h=p[u]-yo()/2,C=ze()+y*He();sn(t,h,C,yo(),Ye(),m)}t.restore()}const Ge=50;function G(t,e,o,a,d,i){if(typeof t.roundRect=="function")t.roundRect(e,o,a,d,i);else{const n=Math.min(i,a/2,d/2);t.moveTo(e+n,o),t.lineTo(e+a-n,o),t.arcTo(e+a,o,e+a,o+n,n),t.lineTo(e+a,o+d-n),t.arcTo(e+a,o+d,e+a-n,o+d,n),t.lineTo(e+n,o+d),t.arcTo(e,o+d,e,o+d-n,n),t.lineTo(e,o+n),t.arcTo(e,o,e+n,o,n),t.closePath()}}function an(){const t=s.createLinearGradient(0,0,0,Ot.height);t.addColorStop(0,"#fef3c7"),t.addColorStop(.5,"#fefce8"),t.addColorStop(1,"#ecfdf5"),s.fillStyle=t,s.fillRect(0,0,Ot.width,Ot.height),s.fillStyle="#78716c",s.fillRect(0,Ot.height-30,Ot.width,30)}function Mo(t,e,o,a,d){if(a<=0||o<=0)return;s.fillStyle="rgba(0,0,0,0.08)",s.fillRect(t+2,e+2,o,a);const i=s.createLinearGradient(t,0,t+o,0);d==="hot"?(i.addColorStop(0,"#fca5a5"),i.addColorStop(.5,"#fef2f2"),i.addColorStop(1,"#fca5a5")):(i.addColorStop(0,"#93c5fd"),i.addColorStop(.5,"#eff6ff"),i.addColorStop(1,"#93c5fd")),s.fillStyle=i,s.fillRect(t,e,o,a),s.strokeStyle=d==="hot"?"#f87171":"#60a5fa",s.lineWidth=1.5,s.strokeRect(t,e,o,a)}function yt(t,e,o,a,d,i=0){if(o<=0)return;const l=i>0?Math.min(i,o/2,a/2):0;s.fillStyle="rgba(0,0,0,0.08)",l>0?(s.beginPath(),G(s,t+2,e+2,o,a,l),s.fill()):s.fillRect(t+2,e+2,o,a);const n=s.createLinearGradient(0,e,0,e+a);d==="hot"?(n.addColorStop(0,"#fca5a5"),n.addColorStop(.5,"#fef2f2"),n.addColorStop(1,"#fca5a5")):(n.addColorStop(0,"#93c5fd"),n.addColorStop(.5,"#eff6ff"),n.addColorStop(1,"#93c5fd")),s.fillStyle=n,l>0?(s.beginPath(),G(s,t,e,o,a,l),s.fill()):s.fillRect(t,e,o,a),s.strokeStyle=d==="hot"?"#f87171":"#60a5fa",s.lineWidth=1.5,l>0?(s.beginPath(),G(s,t,e,o,a,l),s.stroke()):s.strokeRect(t,e,o,a)}function ns(t,e,o,a,d,i,l,n=!0){const p=t.createLinearGradient(e-36,o-10,e-36,o+10);if(p.addColorStop(0,"#b0b0b0"),p.addColorStop(.25,"#f0f0f0"),p.addColorStop(.5,"#ffffff"),p.addColorStop(.75,"#c8c8c8"),p.addColorStop(1,"#888"),t.fillStyle=p,t.beginPath(),G(t,e-36,o-20/2,36*2,20,20/2),t.fill(),t.strokeStyle="#686868",t.lineWidth=1.5,t.stroke(),n){const T=e+36,Y=t.createLinearGradient(T,o-24/2,T,o+24/2);Y.addColorStop(0,"#a0a0a0"),Y.addColorStop(.4,"#e8e8e8"),Y.addColorStop(1,"#707070"),t.fillStyle=Y,t.beginPath(),t.moveTo(T+4,o-24/2),t.lineTo(T+24,o-24/2+5),t.lineTo(T+24,o+24/2-5),t.lineTo(T+4,o+24/2),t.lineTo(T,o+24/2-2),t.lineTo(T,o-24/2+2),t.closePath(),t.fill(),t.strokeStyle="#606060",t.lineWidth=1,t.stroke();const A=t.createRadialGradient(T+24/2+2,o,1,T+24/2+2,o,7);A.addColorStop(0,"#b8860b"),A.addColorStop(1,"#6b4e0b"),t.fillStyle=A,t.beginPath(),t.arc(T+24/2+3,o,6,0,Math.PI*2),t.fill()}const m=-1,u=24,y=e-4,h=o-u,C=t.createLinearGradient(e-4,h,e+4,h);C.addColorStop(0,"#c0c0c0"),C.addColorStop(.5,"#fff"),C.addColorStop(1,"#a0a0a0"),t.fillStyle=C,t.beginPath(),G(t,y,h,8,u,2),t.fill(),t.strokeStyle="#909090",t.lineWidth=1,t.stroke();const I=e,$=o+m*u,g=t.createRadialGradient(I-2,$-2,1,I,$,8);g.addColorStop(0,"#ffffff"),g.addColorStop(.4,"#d8d8d8"),g.addColorStop(1,"#707070"),t.fillStyle=g,t.beginPath(),t.arc(I,$,8,0,Math.PI*2),t.fill(),t.strokeStyle="#606060",t.lineWidth=1,t.stroke();const b=28,B=10,_=$+m*4,E=t.createLinearGradient(e-b,_-B,e,_+B);E.addColorStop(0,d),E.addColorStop(1,i),t.fillStyle=E,t.beginPath(),t.moveTo(e,_-2),t.bezierCurveTo(e-8,_-B-2,e-b,_-B+2,e-b,_+2),t.bezierCurveTo(e-b,_+B,e-8,_+B-2,e,_+4),t.closePath(),t.fill(),t.strokeStyle=i,t.lineWidth=1,t.stroke();const P=t.createLinearGradient(e,_-B,e+b,_+B);P.addColorStop(0,d),P.addColorStop(1,i),t.fillStyle=P,t.beginPath(),t.moveTo(e,_-2),t.bezierCurveTo(e+8,_-B-2,e+b,_-B+2,e+b,_+2),t.bezierCurveTo(e+b,_+B,e+8,_+B-2,e,_+4),t.closePath(),t.fill(),t.strokeStyle=i,t.lineWidth=1,t.stroke()}function Co(t,e,o){s.save(),ns(s,t,e,o?"#e53935":"#1e88e5",o?"#ff7043":"#64b5f6",o?"#b71c1c":"#0d47a1"),s.restore()}function ln(){const t=c.bypassX,e=(c.outletY+c.inletY)/2,o=Tt/100,a=o>.5?"#e53935":o>0?"#f59e0b":"#546e7a",d=o>.5?"#ff7043":o>0?"#ffca28":"#90a4ae",i=o>.5?"#b71c1c":o>0?"#e65100":"#263238";s.save(),s.translate(t,e),s.scale(.65,.65),s.rotate(Math.PI/2),ns(s,0,0,a,d,i,!0,!1),s.restore(),s.fillStyle="#475569",s.font="bold 13px Inter",s.textAlign="center",s.textBaseline="alphabetic",s.fillText(`${Tt}%`,t+28,e+6)}function rn(){const t=c.bypassW,e=c.bypassX-t/2,o=c.outletY-c.pipeH/2,a=c.inletY+c.pipeH/2,d=a-o,i=.3+.7*(Tt/100);s.save(),s.globalAlpha=i,s.fillStyle="rgba(0,0,0,0.08)",s.fillRect(e+3,o+3,t,d);const l=s.createLinearGradient(e,0,e+t,0);l.addColorStop(0,"#71717a"),l.addColorStop(.5,"#d4d4d8"),l.addColorStop(1,"#71717a"),s.fillStyle=l,s.fillRect(e,o,t,d),s.strokeStyle="#52525b",s.lineWidth=1,s.strokeRect(e,o,t,d),s.fillStyle="#b0b0b0";const n=Math.max(t+6,14);s.beginPath(),G(s,e-(n-t)/2,o-3,n,8,3),s.fill(),s.beginPath(),G(s,e-(n-t)/2,a-5,n,8,3),s.fill(),s.restore(),s.fillStyle="#475569",s.font="bold 14px Inter",s.textAlign="right",s.textBaseline="middle",s.fillText('1/2"',c.bypassX-12,(c.outletY+c.inletY)/2),s.save(),s.translate(c.bypassX+32,(c.outletY+c.inletY)/2),s.rotate(-Math.PI/2),s.fillStyle="#64748b",s.font="bold 16px Inter",s.textAlign="center",s.fillText("–ë–ê–ô–ü–ê–°",0,0),s.restore(),ln()}function dn(){const t=c.pipeH,e=ft;e>0?(Mo(0,c.outletY-t/2-e,t,e+t,"cold"),yt(t,c.outletY-t/2,c.bypassX-8-t,t,"cold"),Mo(0,c.inletY-t/2,t,e+t,"hot"),yt(t,c.inletY-t/2,c.bypassX-8-t,t,"hot"),yt(c.bypassX+8,c.inletY-t/2,c.valveX-c.bypassX-8-22,t,"hot"),yt(c.bypassX+8,c.outletY-t/2,c.valveX-c.bypassX-8-22,t,"cold")):(yt(0,c.inletY-t/2,c.bypassX-8,t,"hot"),yt(0,c.outletY-t/2,c.bypassX-8,t,"cold"),yt(c.bypassX+8,c.inletY-t/2,c.valveX-c.bypassX-30,t,"hot"),yt(c.bypassX+8,c.outletY-t/2,c.valveX-c.bypassX-30,t,"cold")),yt(c.valveX+28,c.inletY-t/2,c.radStartX-c.valveX-28,t,"hot"),yt(c.valveX+28,c.outletY-t/2,c.radStartX-c.valveX-28,t,"cold"),s.fillStyle="#475569",s.font="bold 14px Inter",s.textAlign="center",s.textBaseline="bottom",s.fillText('3/4"',80,c.outletY-t/2-6),s.fillText('3/4"',80,c.inletY-t/2-6),rn(),Co(c.valveX,c.inletY,!0),Co(c.valveX,c.outletY,!1)}function Eo(t,e,o,a,d,i,l){const n=M.supplyT||70,f=(c.radEndX-c.radStartX)/w,r=z.T_room_eq||20,p=[];if(l)if(Q==="bad"&&nt&&Qt.length>=w)for(let m=0;m<w;m++)p.push(Qt[m]||mt[m]||r);else for(let m=0;m<w;m++)p.push(mt[m]||r);else for(let m=0;m<w;m++)p.push(mt[m]||r);s.fillStyle="rgba(0,0,0,0.12)",s.beginPath(),G(s,t+3,e+3,o,a,6),s.fill(),s.save(),s.beginPath(),G(s,t,e,o,a,6),s.clip();for(let m=0;m<w;m++){const u=c.radStartX-10+m*f,y=p[m]||r,h=dt(y,n,r),C=s.createLinearGradient(0,e,0,e+a);C.addColorStop(0,`rgba(${Math.min(h.r+50,255)},${Math.min(h.g+50,255)},${Math.min(h.b+50,255)},1)`),C.addColorStop(.4,`rgb(${h.r},${h.g},${h.b})`),C.addColorStop(.8,`rgb(${Math.max(h.r-40,0)},${Math.max(h.g-40,0)},${Math.max(h.b-40,0)})`),C.addColorStop(1,`rgb(${h.r},${h.g},${h.b})`),s.fillStyle=C,s.fillRect(u,e,f+1,a),m>0&&(s.strokeStyle="rgba(0,0,0,0.08)",s.lineWidth=.5,s.beginPath(),s.moveTo(u,e+2),s.lineTo(u,e+a-2),s.stroke())}if(s.fillStyle="rgba(255,255,255,0.15)",s.fillRect(t+4,e+2,o-8,a*.25),s.restore(),s.strokeStyle="rgba(80,80,80,0.4)",s.lineWidth=2,s.beginPath(),G(s,t,e,o,a,6),s.stroke(),s.fillStyle="#606060",s.beginPath(),G(s,t-5,e+3,10,a-6,3),s.fill(),s.beginPath(),G(s,t+o-5,e+3,10,a-6,3),s.fill(),s.fillStyle="#475569",s.font="bold 16px Inter",s.textAlign="center",s.fillText(d,t+o/2,i),l&&Q==="bad"&&nt){if(s.save(),s.globalAlpha=.6,s.fillStyle="#3b82f6",s.font="bold 16px Arial",s.fillText("‚Üê –æ–±—Ä–∞—Ç–∫–∞",t+70,e+a/2+5),zt>=0){const m=c.radStartX+(zt+1)*f;s.fillStyle="#f59e0b",s.font="bold 14px Arial",s.fillText("‚Üí –ø—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ ‚Üí",t+o/2-30,e+a/2+5),s.strokeStyle="#f59e0b",s.lineWidth=2,s.setLineDash([4,4]),s.beginPath(),s.moveTo(m,e),s.lineTo(m,e+a),s.stroke(),s.setLineDash([])}s.restore()}}function cn(t,e,o){const a=M.supplyT||70,d=(M.nomPower||2e3)/w;if(d<=0)return;const i=M.secPowers[o]||0,l=M.secRetTemps[o]||a,n=M.secFlowLPM[o]||0,f=M.secEps[o]||0,r=c.secTopY,p=c.secBotY-c.secTopY,m=mt[o];if(pt[o]){s.fillStyle="rgba(0,0,0,0.2)",s.fillRect(t+3,r+3,e,p);const v=s.createLinearGradient(t,0,t+e,0);v.addColorStop(0,"rgba(200,230,255,1)"),v.addColorStop(.3,"rgba(230,245,255,1)"),v.addColorStop(.5,"rgba(240,250,255,1)"),v.addColorStop(.7,"rgba(230,245,255,1)"),v.addColorStop(1,"rgba(200,230,255,1)"),s.fillStyle=v,s.beginPath(),G(s,t,r,e,p,4),s.fill();const S=11,T=p/(S+1);s.strokeStyle="rgba(150,190,220,0.4)",s.lineWidth=2;for(let j=1;j<=S;j++){const tt=r+j*T;s.beginPath(),s.moveTo(t+2,tt),s.lineTo(t+e-2,tt),s.stroke()}s.fillStyle="rgba(180,220,255,0.8)";for(let j=1;j<=S;j++){const tt=r+j*T;s.beginPath(),s.moveTo(t,tt-4),s.lineTo(t-5,tt),s.lineTo(t,tt+4),s.closePath(),s.fill(),s.beginPath(),s.moveTo(t+e,tt-4),s.lineTo(t+e+5,tt),s.lineTo(t+e,tt+4),s.closePath(),s.fill()}const Y=12,A=t+e/2-Y/2,O=6,K=r+O,V=p-O*2;s.fillStyle="#2c3e50",s.beginPath(),G(s,A-2,K-2,Y+4,V+4,3),s.fill(),s.fillStyle="rgba(200,230,255,0.9)",s.beginPath(),G(s,A,K,Y,V,2),s.fill(),s.fillStyle="rgba(255,255,255,0.4)",s.fillRect(A+2,K,3,V),s.strokeStyle="rgba(59,130,246,0.8)",s.lineWidth=3,s.beginPath(),G(s,t,r,e,p,4),s.stroke();const D=.3+.2*Math.sin(re*.08+o*.3);s.save(),s.globalAlpha=D;const ut=s.createRadialGradient(t+e/2,r+p/2,10,t+e/2,r+p/2,p/1.5+15);ut.addColorStop(0,"rgba(180,220,255,0.4)"),ut.addColorStop(1,"rgba(180,220,255,0)"),s.fillStyle=ut,s.fillRect(t-15,r-15,e+30,p+30),s.restore();const Z=t+e/2,L=c.secBotY+c.collH+50;s.textAlign="center",s.fillStyle="#475569",s.font="bold 20px Inter",s.fillText(`${o+1}`,Z,r-14),s.font="bold 18px JetBrains Mono",s.fillStyle="#3b82f6",s.fillText("‚ùÑÔ∏è –õ–Å–î",Z,L),s.font="bold 16px JetBrains Mono",s.fillText(`${m.toFixed(0)}¬∞C`,Z,L+22),s.fillStyle="#64748b",s.font="14px JetBrains Mono",s.fillText("0.00",Z,L+42),s.fillStyle="#ef4444",s.font="bold 14px JetBrains Mono",s.fillText("–ó–ê–ú–ï–†–ó–õ–ê",Z,L+60),s.beginPath(),s.arc(Z,L+76,5,0,Math.PI*2),s.fillStyle="#3b82f6",s.fill();return}const u=dt(m,a,z.T_room_eq);s.fillStyle="rgba(0,0,0,0.1)",s.fillRect(t+3,r+3,e,p);const y=s.createLinearGradient(t,0,t+e,0);y.addColorStop(0,`rgba(${Math.max(u.r-30,0)},${Math.max(u.g-30,0)},${Math.max(u.b-30,0)},1)`),y.addColorStop(.3,`rgba(${Math.min(u.r+40,255)},${Math.min(u.g+40,255)},${Math.min(u.b+40,255)},1)`),y.addColorStop(.5,`rgba(${Math.min(u.r+60,255)},${Math.min(u.g+60,255)},${Math.min(u.b+60,255)},1)`),y.addColorStop(.7,`rgba(${Math.min(u.r+40,255)},${Math.min(u.g+40,255)},${Math.min(u.b+40,255)},1)`),y.addColorStop(1,`rgba(${Math.max(u.r-30,0)},${Math.max(u.g-30,0)},${Math.max(u.b-30,0)},1)`),s.fillStyle=y,s.beginPath(),G(s,t,r,e,p,4),s.fill();const h=11,C=p/(h+1);s.strokeStyle=`rgba(${Math.max(u.r-60,0)},${Math.max(u.g-60,0)},${Math.max(u.b-60,0)},0.15)`,s.lineWidth=1;for(let v=1;v<=h;v++){const S=r+v*C;s.beginPath(),s.moveTo(t+2,S),s.lineTo(t+e-2,S),s.stroke()}s.fillStyle=`rgba(${u.r},${u.g},${u.b},0.7)`;for(let v=1;v<=h;v++){const S=r+v*C;s.beginPath(),s.moveTo(t,S-3),s.lineTo(t-4,S),s.lineTo(t,S+3),s.closePath(),s.fill(),s.beginPath(),s.moveTo(t+e,S-3),s.lineTo(t+e+4,S),s.lineTo(t+e,S+3),s.closePath(),s.fill()}const I=12,$=t+e/2-I/2,g=6,b=r+g,B=p-g*2;if(s.fillStyle="#484848",s.beginPath(),G(s,$-2,b-2,I+4,B+4,3),s.fill(),n>.001){const v=dt(a,a),S=dt(l,a),T=s.createLinearGradient(0,b+B,0,b);T.addColorStop(0,`rgb(${v.r},${v.g},${v.b})`),T.addColorStop(1,`rgb(${S.r},${S.g},${S.b})`),s.fillStyle=T}else{const v=dt(z.T_room_eq||20,a);s.fillStyle=`rgba(${v.r},${v.g},${v.b},0.6)`}s.beginPath(),G(s,$,b,I,B,2),s.fill(),s.fillStyle="rgba(255,255,255,0.15)",s.fillRect($+2,b,3,B),s.strokeStyle=`rgba(${Math.max(u.r-80,0)},${Math.max(u.g-80,0)},${Math.max(u.b-80,0)},0.6)`,s.lineWidth=1.5,s.beginPath(),G(s,t,r,e,p,4),s.stroke();const _=H(i/d,0,1);if(i>10){const v=.7+.3*Math.sin(re*.03+o*.5);s.save(),s.globalAlpha=_*.2*v;const S=12,T=s.createRadialGradient(t+e/2,r+p/2,10,t+e/2,r+p/2,p/1.5+S);T.addColorStop(0,`rgba(${u.r},${u.g},${u.b},0.3)`),T.addColorStop(1,`rgba(${u.r},${u.g},${u.b},0)`),s.fillStyle=T,s.fillRect(t-S,r-S,e+S*2,p+S*2),s.restore()}const E=t+e/2,P=c.secBotY+c.collH+50;s.textAlign="center",s.fillStyle="#475569",s.font="bold 20px Inter",s.fillText(`${o+1}`,E,r-14),s.font="bold 18px JetBrains Mono",s.fillStyle=ne(m,a),s.fillText(`${i.toFixed(0)}–í—Ç`,E,P),s.font="bold 16px JetBrains Mono",s.fillText(`${m.toFixed(0)}¬∞C`,E,P+22),s.fillStyle="#64748b",s.font="14px JetBrains Mono",s.fillText(`${n.toFixed(2)}`,E,P+42),s.fillStyle="#8b5cf6",s.font="bold 14px JetBrains Mono",s.fillText(`Œµ${(f*100).toFixed(0)}%`,E,P+60),s.beginPath(),s.arc(E,P+76,5,0,Math.PI*2),s.fillStyle=m>$t?"#dc2626":"#2563eb",s.fill()}function pn(){if(Q!=="bad")return;const t=M.supplyT||70,e=(c.radEndX-c.radStartX)/w;s.font="bold 11px JetBrains Mono",s.textAlign="center";for(let o=0;o<w;o++){const a=c.radStartX+o*e+e/2,d=Qt[o]||20,i=mt[o]||20,l=dt(d,t,z.T_room_eq),n=de[o];n>0&&d>i+1&&(s.fillStyle=`rgb(${l.r},${l.g},${l.b})`,s.fillText(`${d.toFixed(0)}¬∞ (${n})`,a,c.topCollY-6))}}function fn(){const t=c.radEndX-c.radStartX,e=t/w;Eo(c.radStartX-10,c.topCollY,t+20,c.collH,"‚ñ≤ –í–ï–†–•–ù–ò–ô –ö–û–õ–õ–ï–ö–¢–û–† (–æ–±—Ä–∞—Ç–∫–∞)",c.topCollY-18,!0),Eo(c.radStartX-10,c.botCollY,t+20,c.collH,"‚ñº –ù–ò–ñ–ù–ò–ô –ö–û–õ–õ–ï–ö–¢–û–† (–ø–æ–¥–∞—á–∞)",c.botCollY+c.collH+20,!1);for(let o=0;o<w;o++)cn(c.radStartX+o*e,e-4,o);pn(),Q==="good"&&mn()}function mn(){const t=s.createLinearGradient(c.radStartX,0,c.radEndX,0);t.addColorStop(0,"#dc2626"),t.addColorStop(1,"#f97316"),s.strokeStyle=t,s.lineWidth=8,s.lineCap="round",s.beginPath(),s.moveTo(c.radStartX,c.inletY),s.lineTo(c.radEndX-20,c.inletY),s.stroke(),s.fillStyle="white",s.font="bold 16px Arial",s.textAlign="center";for(let e=0;e<5;e++)s.fillText("‚Üí",c.radStartX+100+e*200,c.inletY+5);s.fillStyle="#dc2626",s.font="bold 16px Inter",s.fillText("–£–î–õ–ò–ù–ò–¢–ï–õ–¨ –ü–û–¢–û–ö–ê",(c.radStartX+c.radEndX)/2,c.botCollY+c.collH+40)}function un(){s.textAlign="center",ce&&(s.fillStyle="#1e293b",s.font="bold 28px Inter",s.fillText("–¢–ï–ü–õ–û–í–û–ô –ë–ê–õ–ê–ù–° –ü–û–ú–ï–©–ï–ù–ò–Ø",(c.radStartX+c.radEndX)/2,48));const t=pt.filter(e=>e).length;if(t>0){s.save();const e=Ot.width/2,o=150;s.globalAlpha=.9,s.fillStyle=Ke?"#dc2626":"#f59e0b",s.beginPath(),G(s,e-350,o-30,700,60,15),s.fill(),s.strokeStyle="#fff",s.lineWidth=3,s.stroke(),s.globalAlpha=1,s.fillStyle="#fff",s.font="bold 24px Inter",s.textAlign="center",Ke?(s.fillText("üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ê–í–ê–†–ò–Ø! –°–ò–°–¢–ï–ú–ê –ó–ê–ú–ï–†–ó–õ–ê! üö®",e,o-5),s.font="18px Inter",s.fillText(`–ó–∞–º–µ—Ä–∑–ª–æ ${t} –∏–∑ ${w} —Å–µ–∫—Ü–∏–π ‚Ä¢ –¶–∏—Ä–∫—É–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞`,e,o+20)):(s.fillText("‚ùÑÔ∏è –í–ù–ò–ú–ê–ù–ò–ï! –û–ë–ù–ê–†–£–ñ–ï–ù–û –ó–ê–ú–ï–†–ó–ê–ù–ò–ï! ‚ùÑÔ∏è",e,o-5),s.font="18px Inter",s.fillText(`–ó–∞–º–µ—Ä–∑–ª–æ ${t} —Å–µ–∫—Ü–∏–π ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–∞—è —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∞`,e,o+20)),s.restore()}}function hn(){const t=M.supplyT||70,e=z.T_room_eq||20,o=Math.min(e,$t-1),a=document.getElementById("temp-gradient-bar");if(!a)return;const d=[];for(let i=0;i<=20;i++){const l=o+(t-o)*(i/20),n=dt(l,t,o);d.push(`rgb(${n.r},${n.g},${n.b}) ${(i/20*100).toFixed(1)}%`)}a.style.background=`linear-gradient(90deg, ${d.join(", ")})`}function gn(){const t=document.getElementById("simCanvasBelow");if(!t)return;const e=t.getContext("2d");if(!e)return;const o=t.width,a=t.height;e.fillStyle="#fefce8",e.fillRect(0,0,o,a),e.fillStyle="#78716c",e.fillRect(0,0,o,Ge),e.fillStyle="#fff",e.font="bold 16px Inter",e.textAlign="center",e.textBaseline="middle",e.fillText("6 —Ä–∞–¥–∏–∞—Ç–æ—Ä–æ–≤ —Å–∏–º—É–ª—è—Ü–∏—è",o/2,Ge/2),nn(e,o,a,Ge)}function bn(){an(),dn(),fn(),un(),st.forEach(t=>t.draw()),gn()}const yn=150;let he=null;function as(){he&&clearTimeout(he),he=setTimeout(()=>{he=null,Ut()},yn)}function gt(){const t=document.getElementById("simCanvasBelow");t&&(t.width=Dt,t.height=Gt)}function R(){var t,e,o,a,d,i,l,n,f,r,p,m,u,y,h,C,I,$,g,b,B,_,E,P,v,S,T,Y,A,O,K;try{const V={nominalPower:(t=document.getElementById("nominalPower"))==null?void 0:t.value,heatLossDesign:(e=document.getElementById("heatLossDesign"))==null?void 0:e.value,designOutTemp:(o=document.getElementById("designOutTemp"))==null?void 0:o.value,desiredRoomTemp:(a=document.getElementById("desiredRoomTemp"))==null?void 0:a.value,supplyTemp:(d=document.getElementById("supplyTemp"))==null?void 0:d.value,systemFlow:(i=document.getElementById("systemFlow"))==null?void 0:i.value,outsideTemp:(l=document.getElementById("outsideTemp"))==null?void 0:l.value,internalGains:(n=document.getElementById("internalGains"))==null?void 0:n.value,bypassValve:(f=document.getElementById("bypassValve"))==null?void 0:f.value,heatLossCoeff:(r=document.getElementById("heat-loss-coeff"))==null?void 0:r.value,particlesPerLiter:(p=document.getElementById("particles-per-liter"))==null?void 0:p.value,gravityForce:(m=document.getElementById("gravity-force"))==null?void 0:m.value,mainPipeD:(u=document.getElementById("main-pipe-d"))==null?void 0:u.value,mainPipeL:(y=document.getElementById("main-pipe-L"))==null?void 0:y.value,bypassPipeD:(h=document.getElementById("bypass-pipe-d"))==null?void 0:h.value,bypassPipeL:(C=document.getElementById("bypass-pipe-L"))==null?void 0:C.value,radPipeD:(I=document.getElementById("rad-pipe-d"))==null?void 0:I.value,radPipeL:($=document.getElementById("rad-pipe-L"))==null?void 0:$.value,valve34Zeta:(g=document.getElementById("valve-34-zeta"))==null?void 0:g.value,valve12Zeta:(b=document.getElementById("valve-12-zeta"))==null?void 0:b.value,teeZeta:(B=document.getElementById("tee-zeta"))==null?void 0:B.value,radiatorZeta:(_=document.getElementById("radiator-zeta"))==null?void 0:_.value,waterRho:(E=document.getElementById("water-rho"))==null?void 0:E.value,waterNu:(P=document.getElementById("water-nu"))==null?void 0:P.value,waterG:(v=document.getElementById("water-g"))==null?void 0:v.value,riserSupplyTemp:(S=document.getElementById("riser-supply-temp"))==null?void 0:S.value,riserFlow:(T=document.getElementById("riser-flow"))==null?void 0:T.value,riserRadPower:(Y=document.getElementById("riser-rad-power"))==null?void 0:Y.value,riserRoomTemp:(A=document.getElementById("riser-room-temp"))==null?void 0:A.value,riserPipeD:(O=document.getElementById("riser-pipe-d"))==null?void 0:O.value,riserBypassD:(K=document.getElementById("riser-bypass-d"))==null?void 0:K.value,mode:Q,counterflowEnabled:nt,openFactors:[...ct],riserBypassOpen:[...Et],hydraulicsMenuVisible:we,resistanceVisible:Te,riserVisible:_e,radiatorSimulationMenuVisible:Se,balanceVisible:ce,flowDynamicsVisible:Me,canvasVisible:Ce,radWidth:_t,radHeight:St,radPosX:Mt,radPosY:Ct,leftPipeExt:ft,canvasHeight:vt,canvasWidth:wt,sixRadCanvasWidth:Dt,sixRadCanvasHeight:Gt,sixRadViewScale:Nt,sixRadBypassOpenPct:[...At],collectorVisible:Ee,metricsVisible:Be,sectionsVisible:Ie,analysisVisible:Pe,sectionControlsVisible:$e,sizeControlsVisible:Ht};localStorage.setItem(Fo,JSON.stringify(V))}catch{}}function vn(){var t;try{const e=localStorage.getItem(Fo);if(!e)return;const o=JSON.parse(e),a=(r,p)=>{const m=document.getElementById(r);m&&p!=null&&(m.value=p)};if(a("nominalPower",o.nominalPower),a("heatLossDesign",o.heatLossDesign),a("designOutTemp",o.designOutTemp),a("desiredRoomTemp",o.desiredRoomTemp??"20"),a("supplyTemp",o.supplyTemp),a("systemFlow",o.systemFlow),a("outsideTemp",o.outsideTemp),a("internalGains",o.internalGains),a("bypassValve",o.bypassValve),a("heat-loss-coeff",o.heatLossCoeff),a("particles-per-liter",o.particlesPerLiter),a("gravity-force",o.gravityForce),a("main-pipe-d",o.mainPipeD),a("main-pipe-L",o.mainPipeL),a("bypass-pipe-d",o.bypassPipeD),a("bypass-pipe-L",o.bypassPipeL),a("rad-pipe-d",o.radPipeD),a("rad-pipe-L",o.radPipeL),a("valve-34-zeta",o.valve34Zeta),a("valve-12-zeta",o.valve12Zeta),a("tee-zeta",o.teeZeta),a("radiator-zeta",o.radiatorZeta),a("water-rho",o.waterRho),a("water-nu",o.waterNu),a("water-g",o.waterG),a("riser-supply-temp",o.riserSupplyTemp),a("riser-flow",o.riserFlow),a("riser-rad-power",o.riserRadPower),a("riser-room-temp",o.riserRoomTemp),a("riser-pipe-d",o.riserPipeD),a("riser-bypass-d",o.riserBypassD),o.mode&&ko(o.mode),typeof o.counterflowEnabled=="boolean"&&Yo(o.counterflowEnabled),Array.isArray(o.openFactors)&&o.openFactors.length===w){for(let r=0;r<w;r++)ct[r]=o.openFactors[r];for(let r=0;r<w;r++){const p=document.getElementById(`slider-${r}`),m=document.getElementById(`value-${r}`);p&&(p.value=String(Math.round(ct[r]*100))),m&&(m.textContent=`${Math.round(ct[r]*100)}%`)}}if(Array.isArray(o.riserBypassOpen)&&o.riserBypassOpen.length===ve)for(let r=0;r<ve;r++)Et[r]=o.riserBypassOpen[r];if(Array.isArray(o.sixRadBypassOpenPct)&&o.sixRadBypassOpenPct.length===6){for(let r=0;r<6;r++)xe(r,o.sixRadBypassOpenPct[r]);for(let r=0;r<6;r++){const p=document.getElementById(`six-rad-bypass-${r}`),m=document.getElementById(`six-rad-bypass-val-${r}`);p&&(p.value=String(Math.round(At[r]))),m&&(m.textContent=`${Math.round(At[r])}%`)}}if(o.hydraulicsMenuVisible){Ho(!0);const r=document.getElementById("hydraulics-submenu"),p=document.getElementById("btn-hydraulics-menu");r&&(r.style.display="flex"),p&&(p.innerHTML="üîΩ –°–∫—Ä—ã—Ç—å –º–µ–Ω—é",p.classList.add("ring-2","ring-slate-400"))}if(o.radiatorSimulationMenuVisible){Xo(!0);const r=document.getElementById("radiator-simulation-submenu"),p=document.getElementById("btn-radiator-simulation-menu");r&&(r.style.display="flex"),p&&(p.innerHTML="üîΩ –°–∫—Ä—ã—Ç—å –º–µ–Ω—é",p.classList.add("ring-2","ring-slate-400"))}if(o.balanceVisible){Oo(!0);const r=document.getElementById("balance-result"),p=document.getElementById("btn-balance");r&&(r.style.display="block"),p&&(p.classList.remove("bg-white","text-amber-700"),p.classList.add("bg-amber-500","text-white","border-amber-600"))}if(o.resistanceVisible){zo(!0);const r=document.getElementById("hydraulic-section"),p=document.getElementById("btn-resistance");r&&(r.style.display="block"),p&&(p.classList.remove("bg-white","text-sky-700"),p.classList.add("bg-sky-500","text-white","border-sky-600"))}if(o.riserVisible){Ao(!0);const r=document.getElementById("riser-calc-section"),p=document.getElementById("btn-riser");r&&(r.style.display="block"),p&&(p.classList.remove("bg-white","text-purple-700"),p.classList.add("bg-purple-500","text-white","border-purple-600"))}if(o.flowDynamicsVisible){Vo(!0);const r=document.getElementById("flow-dynamics-section"),p=document.getElementById("btn-flow-dynamics-menu");r&&(r.style.display="block"),p&&(p.classList.remove("bg-white","text-pink-700"),p.classList.add("bg-pink-500","text-white","border-pink-600"))}const d=(r,p,m,u,y,h)=>{if(!r)return;const C=document.getElementById(p),I=document.getElementById(m);C&&(C.style.display=h||"block"),I&&(I.classList.remove(y),I.classList.add(u))},i=o.canvasVisible||o.bypassVisible||o.radiatorParamsVisible;if(d(i,"visualization-section","btn-canvas","bg-indigo-500 text-white border-indigo-600","bg-white text-indigo-700"),d(o.collectorVisible,"collector-section","btn-collector","bg-orange-500 text-white border-orange-600","bg-white text-orange-700"),d(o.metricsVisible,"metrics-section","btn-metrics","bg-teal-500 text-white border-teal-600","bg-white text-teal-700","flex"),d(o.sectionsVisible,"sections-section","btn-sections","bg-violet-500 text-white border-violet-600","bg-white text-violet-700"),d(o.analysisVisible,"analysis-section","btn-analysis","bg-slate-500 text-white border-slate-600","bg-white text-slate-700"),d(o.sectionControlsVisible,"section-controls-section","btn-section-controls","bg-sky-500 text-white border-sky-600","bg-white text-sky-700"),typeof o.sizeControlsVisible=="boolean"){je(o.sizeControlsVisible);const r=document.getElementById("size-controls-section"),p=document.getElementById("btn-size-controls");r&&(r.style.display=Ht?"flex":"none"),p&&(p.innerHTML=Ht?"üîΩ –°–∫—Ä—ã—Ç—å —Ä–∞–∑–º–µ—Ä—ã":"üìê –†–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏—è",p.classList.toggle("ring-2",Ht),p.classList.toggle("ring-slate-400",Ht))}if(i&&Wo(!0),typeof o.radWidth=="number"&&o.radWidth>=400&&o.radWidth<=1400){Ue(o.radWidth);const r=document.getElementById("rad-width");r&&(r.value=String(_t))}if(typeof o.radHeight=="number"&&o.radHeight>=200&&o.radHeight<=600){Je(o.radHeight);const r=document.getElementById("rad-height");r&&(r.value=String(St))}if(typeof o.radPosX=="number"&&o.radPosX>=285&&o.radPosX<=600){Ze(o.radPosX);const r=document.getElementById("rad-pos-x");r&&(r.value=String(Mt))}if(typeof o.radPosY=="number"&&o.radPosY>=100&&o.radPosY<=400){to(o.radPosY);const r=document.getElementById("rad-pos-y");r&&(r.value=String(Ct))}if(typeof o.leftPipeExt=="number"&&o.leftPipeExt>=0&&o.leftPipeExt<=300){eo(o.leftPipeExt);const r=document.getElementById("left-pipe-ext"),p=document.getElementById("left-pipe-ext-val");r&&(r.value=String(ft)),p&&(p.textContent=String(ft))}if(typeof o.canvasHeight=="number"&&o.canvasHeight>=700&&o.canvasHeight<=1050){oo(o.canvasHeight);const r=document.getElementById("canvas-height");r&&(r.value=String(vt));const p=document.getElementById("simCanvas");p&&(p.height=vt)}if(typeof o.canvasWidth=="number"&&o.canvasWidth>=1e3&&o.canvasWidth<=2e3){so(o.canvasWidth);const r=document.getElementById("canvas-width");r&&(r.value=String(wt));const p=document.getElementById("simCanvas");p&&(p.width=wt)}if(typeof o.sixRadCanvasWidth=="number"&&o.sixRadCanvasWidth>=1e3&&o.sixRadCanvasWidth<=2e3){no(o.sixRadCanvasWidth);const r=document.getElementById("six-rad-canvas-width");r&&(r.value=String(Dt)),gt()}if(typeof o.sixRadCanvasHeight=="number"&&o.sixRadCanvasHeight>=600&&o.sixRadCanvasHeight<=1200){ao(o.sixRadCanvasHeight);const r=document.getElementById("six-rad-canvas-height");r&&(r.value=String(Gt)),gt()}if(typeof o.sixRadViewScale=="number"&&o.sixRadViewScale>=.8&&o.sixRadViewScale<=1.5){io(o.sixRadViewScale);const r=document.getElementById("six-rad-view-scale");r&&(r.value=String(Nt))}Fe(_t,St,Mt,Ct),o.collectorVisible&&Do(!0),o.metricsVisible&&Go(!0),o.sectionsVisible&&No(!0),o.analysisVisible&&Qo(!0),o.sectionControlsVisible&&Ko(!0),o.sizeControlsVisible&&je(!0),po(parseInt(((t=document.getElementById("bypassValve"))==null?void 0:t.value)||"")||100);const l=document.getElementById("btn-counterflow");l&&(nt?(l.innerHTML="üîÑ –ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–ö–õ",l.classList.remove("inactive"),l.classList.add("active")):(l.innerHTML="üîÑ –ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–´–ö–õ",l.classList.remove("active"),l.classList.add("inactive")));const n=document.getElementById("btn-bad"),f=document.getElementById("btn-good");n&&(n.className=Q==="bad"?"mode-btn mode-active px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-900 border-2 border-slate-300 shadow-sm":"mode-btn px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-600 border-2 border-slate-200"),f&&(f.className=Q==="good"?"mode-btn mode-active px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-900 border-2 border-slate-300 shadow-sm":"mode-btn px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-600 border-2 border-slate-200"),mo()}catch{}}function wn(){po(parseInt(document.getElementById("bypassValve").value));const t=document.getElementById("bypass-valve-value");t&&(t.textContent=`${Tt}%`)}function Tn(){Yo(!nt);const t=document.getElementById("btn-counterflow");t&&(nt?(t.innerHTML="üîÑ –ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–ö–õ",t.classList.remove("inactive"),t.classList.add("active")):(t.innerHTML="üîÑ –ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–´–ö–õ",t.classList.remove("active"),t.classList.add("inactive"),co(-1))),Ut(),st.forEach(e=>e.reset()),R()}function mo(){var t,e,o,a,d,i,l,n,f,r,p,m,u,y,h,C,I,$,g,b,B,_,E,P,v,S,T,Y;W.main_pipe.d_mm=Math.max(.1,parseFloat(((e=(t=document.getElementById("main-pipe-d"))==null?void 0:t.value)==null?void 0:e.trim())||"")||20.4),W.main_pipe.L_m=Math.max(.1,parseFloat(((a=(o=document.getElementById("main-pipe-L"))==null?void 0:o.value)==null?void 0:a.trim())||"")||2),W.bypass_pipe.d_mm=Math.max(.1,parseFloat(((i=(d=document.getElementById("bypass-pipe-d"))==null?void 0:d.value)==null?void 0:i.trim())||"")||15.6),W.bypass_pipe.L_m=Math.max(.1,parseFloat(((n=(l=document.getElementById("bypass-pipe-L"))==null?void 0:l.value)==null?void 0:n.trim())||"")||1),W.rad_pipe.d_mm=Math.max(.1,parseFloat(((r=(f=document.getElementById("rad-pipe-d"))==null?void 0:f.value)==null?void 0:r.trim())||"")||20.4),W.rad_pipe.L_m=Math.max(.1,parseFloat(((m=(p=document.getElementById("rad-pipe-L"))==null?void 0:p.value)==null?void 0:m.trim())||"")||1.5),F.ball_valve_34.zeta_open=Math.max(0,parseFloat(((y=(u=document.getElementById("valve-34-zeta"))==null?void 0:u.value)==null?void 0:y.trim())||"")||.3),F.ball_valve_12.zeta_open=Math.max(0,parseFloat(((C=(h=document.getElementById("valve-12-zeta"))==null?void 0:h.value)==null?void 0:C.trim())||"")||.5),F.tee.zeta=Math.max(0,parseFloat((($=(I=document.getElementById("tee-zeta"))==null?void 0:I.value)==null?void 0:$.trim())||"")||1.5),F.radiator.zeta=Math.max(0,parseFloat(((b=(g=document.getElementById("radiator-zeta"))==null?void 0:g.value)==null?void 0:b.trim())||"")||3),at.rho=Math.max(900,parseFloat(((_=(B=document.getElementById("water-rho"))==null?void 0:B.value)==null?void 0:_.trim())||"")||985),at.lambda=Math.max(.001,parseFloat(((P=(E=document.getElementById("water-lambda"))==null?void 0:E.value)==null?void 0:P.trim())||"")||.025),at.nu=Math.max(.001,parseFloat(((S=(v=document.getElementById("water-nu"))==null?void 0:v.value)==null?void 0:S.trim())||"")||.415)*1e-6,at.g=Math.max(9.5,parseFloat(((Y=(T=document.getElementById("water-g"))==null?void 0:T.value)==null?void 0:Y.trim())||"")||9.81),Ut()}function _n(){document.getElementById("main-pipe-d").value="20.4",document.getElementById("main-pipe-L").value="2.0",document.getElementById("bypass-pipe-d").value="15.6",document.getElementById("bypass-pipe-L").value="1.0",document.getElementById("rad-pipe-d").value="20.4",document.getElementById("rad-pipe-L").value="1.5",document.getElementById("valve-34-zeta").value="0.3",document.getElementById("valve-12-zeta").value="0.5",document.getElementById("tee-zeta").value="1.5",document.getElementById("radiator-zeta").value="3.0",document.getElementById("water-rho").value="985",document.getElementById("water-lambda").value="0.025",document.getElementById("water-nu").value="0.415",document.getElementById("water-g").value="9.81",mo()}function le(){var a,d,i;q.heatLossCoeff=parseFloat(((a=document.getElementById("heat-loss-coeff"))==null?void 0:a.value)||"")||.03,q.particlesPerLiter=parseFloat(((d=document.getElementById("particles-per-liter"))==null?void 0:d.value)||"")||50,q.gravityForce=parseFloat(((i=document.getElementById("gravity-force"))==null?void 0:i.value)||"")||.03;const t=document.getElementById("heat-loss-display"),e=document.getElementById("particles-per-liter-display"),o=document.getElementById("gravity-force-display");t&&(t.textContent=q.heatLossCoeff.toFixed(3)),e&&(e.textContent=String(q.particlesPerLiter)),o&&(o.textContent=q.gravityForce.toFixed(3))}function is(){const t=M.sysFlowLPM||4,e=Math.round(t*q.particlesPerLiter),o=document.getElementById("total-particles-display");for(o&&(o.textContent=`‚âà${e} —á–∞—Å—Ç–∏—Ü`);st.length<e;)st.push(new qo);st.length>e&&st.splice(e)}function Sn(){let t=0,e=0,o=0,a=0;const d=Array(w).fill(0);for(const l of st){const n=l;if(n.state!=="exit"&&(t+=n.temp??40,e++,n.state==="stall"&&a++,n.state!=="enter"&&n.state!=="to_rad")){const f=mt[Math.max(0,n.sec??0)]||40;(n.temp??40)<f+2&&o++,(n.sec??0)>=0&&(n.sec??0)<w&&d[n.sec??0]++}}qt.activeCount=e,qt.avgTemp=e>0?t/e:40,qt.bySection=d,qt.coldCount=o,qt.stallCount=a;const i=document.getElementById("particle-stats");i&&(i.textContent=`–ê–∫—Ç–∏–≤–Ω—ã—Ö: ${e} | –°—Ä–µ–¥–Ω. T: ${qt.avgTemp.toFixed(1)}¬∞C | –•–æ–ª–æ–¥–Ω—ã—Ö: ${o} | –í –∑–∞—Å—Ç–æ–µ: ${a}`)}function Mn(){xs(re+1),de.fill(0),Ne.fill(0),Qe.fill(0),le(),is(),st.forEach(t=>{t.update();const e=t;if(e.state==="top_coll"||e.state==="top_coll_right"){const o=(c.radEndX-c.radStartX)/w,a=H(Math.floor((e.x-c.radStartX)/o),0,w-1);de[a]++,e.isCounterflow?Ne[a]++:Qe[a]++}}),Sn(),re%30===0&&Bn()}function ls(){Mn(),bn(),requestAnimationFrame(ls)}function Cn(){pt.fill(!1),lo(!1),ro(!1),Ut(),st.forEach(t=>t.reset())}function Ut(){po(parseInt(document.getElementById("bypassValve").value)),pt.fill(!1),lo(!1),ro(!1),co(Q==="bad"&&nt?4:-1),Os(),As(),En(),hn(),Bt(),R()}function En(){var Z;const t=document.getElementById("btn-thaw");t&&t.classList.toggle("hidden",!pt.some(L=>L));const e=M.nomPower,o=M.supplyT,a=e/w,d=z.T_room_eq,i=M.outsideT,l=M.Kroom,n=(L,j)=>{const tt=document.getElementById(L);tt&&(tt.textContent=j)};n("equilibrium-temp",`${d.toFixed(1)}¬∞C`),n("q-radiator",`${z.Q_rad.toFixed(0)} –í—Ç`),n("q-losses",`${z.Q_loss.toFixed(0)} –í—Ç`),n("kroom-display",`${l.toFixed(2)}`),n("kroom-card",`${l.toFixed(1)}`);const f=document.getElementById("balance-result"),r=document.getElementById("comfort-status");f&&r&&(f.className=d>=20?"metric-card comfort-good mb-6":d>=16?"metric-card comfort-warn mb-6":"metric-card comfort-bad mb-6",r.textContent=d>=20?"‚úÖ –ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ":d>=16?"‚ö† –ü—Ä–æ—Ö–ª–∞–¥–Ω–æ":"‚ùÑÔ∏è –•–æ–ª–æ–¥–Ω–æ!");const p=document.getElementById("balance-equation");p&&(p.innerHTML=`<strong>–ë–∞–ª–∞–Ω—Å:</strong> Q_—Ä–∞–¥=${z.Q_rad.toFixed(0)} –í—Ç = Q_–ø–æ—Ç = K√ó(T_–∫–æ–º–Ω‚àíT_—É–ª)‚àíQ_–∏–Ω—Ç = ${l.toFixed(1)}√ó(${d.toFixed(1)}‚àí${i})‚àí${M.Qint} = ${z.Q_loss.toFixed(0)} –í—Ç (T_—É–ª=${i}¬∞C)`);const m=Number(((Z=document.getElementById("desiredRoomTemp"))==null?void 0:Z.value)??20),u=l*(m-i)-M.Qint,y=z.Q_rad,h=u-y;let C="";m<=i?C=`–ø—Ä–∏ T_–∫–æ–º–Ω=${m}¬∞C ‚â§ T_—É–ª=${i}¬∞C –æ—Ç–æ–ø–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.`:Math.abs(h)<10?C=`–ø—Ä–∏ T_–∫–æ–º–Ω=${m}¬∞C –Ω—É–∂–Ω—ã Q=${u.toFixed(0)} –í—Ç. –†–∞–¥–∏–∞—Ç–æ—Ä –¥–∞—ë—Ç ${y.toFixed(0)} –í—Ç ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.`:h>0?C=`–ø—Ä–∏ T_–∫–æ–º–Ω=${m}¬∞C –Ω—É–∂–Ω—ã Q=${u.toFixed(0)} –í—Ç. –†–∞–¥–∏–∞—Ç–æ—Ä –¥–∞—ë—Ç ${y.toFixed(0)} –í—Ç ‚Äî –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –Ω–∞ ${h.toFixed(0)} –í—Ç (–ø–æ–≤—ã—Å–∏—Ç—å T_–ø–æ–¥–∞—á–∏ –∏–ª–∏ –º–æ—â–Ω–æ—Å—Ç—å —Ä–∞–¥–∏–∞—Ç–æ—Ä–∞).`:C=`–ø—Ä–∏ T_–∫–æ–º–Ω=${m}¬∞C –Ω—É–∂–Ω—ã Q=${u.toFixed(0)} –í—Ç. –†–∞–¥–∏–∞—Ç–æ—Ä –¥–∞—ë—Ç ${y.toFixed(0)} –í—Ç ‚Äî —Å –∑–∞–ø–∞—Å–æ–º ${(-h).toFixed(0)} –í—Ç.`;const I=document.getElementById("desired-temp-text");I&&(I.textContent=C),n("bypass-flow",`${(X.bypassFrac*100).toFixed(0)}%`),n("radiator-flow",`${(X.radFrac*100).toFixed(0)}%`),n("bypass-lpm",`${X.bypassLPM.toFixed(2)} –ª/–º–∏–Ω`),n("radiator-lpm",`${X.radLPM.toFixed(2)} –ª/–º–∏–Ω`),n("bypass-valve-value",`${Tt}%`),n("real-power",`${M.totalPower.toFixed(0)} –í—Ç`);const $=H(M.totalPower/e*100,0,150).toFixed(0);n("efficiency",`${$}%`),n("return-temp",`${M.avgRetTemp.toFixed(1)}¬∞C`),n("delta-t",`${(o-M.avgRetTemp).toFixed(1)}¬∞C`),n("sections-troom",d.toFixed(1));const g=xo,b=g.bypass_path,B=g.radiator_path;n("bypass-flow-hydro",(b.flow??0).toFixed(2)),n("bypass-velocity",(b.velocity??0).toFixed(3)),n("bypass-h-total",g.bypass_path.h_total.toFixed(4)),n("bypass-h-friction",g.bypass_path.h_friction.toFixed(4)),n("bypass-h-local",g.bypass_path.h_local.toFixed(4)),n("bypass-Re",String(b.Re??0)),n("bypass-lambda",(b.lambda??0).toFixed(4)),n("rad-flow-hydro",(B.flow??0).toFixed(2)),n("rad-velocity",(B.velocity??0).toFixed(3)),n("rad-h-total",g.radiator_path.h_total.toFixed(4)),n("rad-h-friction",g.radiator_path.h_friction.toFixed(4)),n("rad-h-local",g.radiator_path.h_local.toFixed(4)),n("rad-Re",String(B.Re??0)),n("rad-lambda",(B.lambda??0).toFixed(4)),n("system-flow-hydro",g.flow.toFixed(2)),n("system-h-current",g.system_total.h_current.toFixed(4)+" –º.–≤.—Å—Ç"),n("system-h-initial",g.system_total.h_initial.toFixed(4)),n("system-h-ratio",`${g.system_total.ratio.toFixed(2)}√ó`);const _=((g.system_total.ratio-1)*100).toFixed(0),E=g.system_total.ratio>=1?`+${_}%`:`${_}%`,P=g.system_total.ratio>2?"#dc2626":g.system_total.ratio>1.5?"#f59e0b":"#22c55e",v=b.lambda??0,S=B.lambda??0,T=document.getElementById("resistance-equation");T&&(T.innerHTML=`<strong>–§–æ—Ä–º—É–ª–∞ –î–∞—Ä—Å–∏-–í–µ–π—Å–±–∞—Ö–∞:</strong> ŒîP = Œª(Re)√ó(L/d)√ó(œÅv¬≤/2) + Œ£Œ∂√ó(œÅv¬≤/2) | <strong>–¢—Ä—É–±–∞ 3/4":</strong> d=${W.main_pipe.d_mm}–º–º | <strong>–ë–∞–π–ø–∞—Å 1/2":</strong> d=${W.bypass_pipe.d_mm}–º–º, Œª=${v.toFixed(4)} | <strong>–†–∞–¥–∏–∞—Ç–æ—Ä:</strong> Œª=${S.toFixed(4)} | –ò–∑–º. ŒîP: <span style="color:${P}"><strong>${E}</strong></span> –ø—Ä–∏ G=${g.flow.toFixed(1)} –ª/–º–∏–Ω`);let Y="";for(let L=0;L<w;L++){const j=M.secPowers[L]||0,tt=M.secFlowLPM[L]||0,Jt=M.secEps[L]||0,pe=H(j/a,0,1),bt=mt[L],Zt=ne(bt,o),fe=ne(bt,o,.15),me=ne(bt,o,.95),U=bt>$t?"üî¥":"üîµ";Y+=`<div class="section-card" style="border-color:${Zt};background:${fe};"><div class="tooltip"><b>–°–µ–∫—Ü–∏—è ‚Ññ${L+1}</b><br>Q=${j.toFixed(1)} –í—Ç<br>T–ø–æ–≤=${bt.toFixed(1)}¬∞C<br>G=${tt.toFixed(3)} –ª/–º–∏–Ω<br>Œµ=${(Jt*100).toFixed(1)}%</div><div class="text-xs font-bold text-slate-600 mb-1">${U} ‚Ññ${L+1}</div><div class="text-lg font-bold" style="color:${me}">${j.toFixed(0)}<span class="text-xs"> –í—Ç</span></div><div class="text-xs font-mono" style="color:${ne(bt,o)}">–ø–æ–≤: ${bt.toFixed(0)}¬∞C</div><div class="text-xs text-teal-600 font-mono">${tt.toFixed(3)} –ª/–º–∏–Ω</div><div class="text-xs text-purple-500 font-mono">Œµ=${(Jt*100).toFixed(0)}%</div><div class="w-full bg-gray-200 rounded-full h-2 mt-1"><div class="h-2 rounded-full" style="width:${(pe*100).toFixed(0)}%;background:${Zt};"></div></div></div>`}const A=document.getElementById("sections-detail");A&&(A.innerHTML=Y);let O='<table class="w-full"><tr class="font-bold text-slate-500"><td>‚Ññ</td><td>T</td><td>Q</td><td>Œî</td></tr>';for(const L of z.log.slice(-8)){const j=Math.abs(L.f)<1?"text-green-600":Math.abs(L.f)<50?"text-amber-600":"text-red-500";O+=`<tr><td>${L.iter}</td><td>${L.T_room.toFixed(2)}</td><td>${L.Q_rad.toFixed(0)}</td><td class="${j}">${L.f.toFixed(1)}</td></tr>`}O+="</table>"+(z.converged?'<div class="text-green-600 font-bold mt-1">‚úÖ –°–æ—à–ª–æ—Å—å</div>':"");const K=document.getElementById("iteration-log");K&&(K.innerHTML=O);const V=M.secPowers.filter(L=>L>a*.25).length;let D=`<p class="font-semibold mb-2">–ü—Ä–∏ T<sub>—É–ª</sub>=${i}¬∞C:</p><p>T<sub>–∫–æ–º–Ω</sub> = <strong>${d.toFixed(1)}¬∞C</strong></p><p>Q: <strong>${M.totalPower.toFixed(0)}</strong>/${e} –í—Ç (${$}%)</p><p>K<sub>room</sub> = ${l.toFixed(2)} –í—Ç/–ö (const)</p>`;Q==="bad"&&(D+=nt?`<p class="text-orange-600 text-xs mt-1">üî• –ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –¥–æ —Å–µ–∫—Ü–∏–∏ ${zt+1}</p>`:'<p class="text-slate-500 text-xs mt-1">–ü—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –≤—ã–∫–ª—é—á–µ–Ω</p>'),D+=`<p class="text-orange-600 text-xs">–ê–∫—Ç–∏–≤–Ω—ã ${V}/10</p>`,Tt===0&&(D+='<p class="text-green-600 mt-2">‚óÜ –ë–∞–π–ø–∞—Å –∑–∞–∫—Ä—ã—Ç</p>'),d<18&&(D+='<p class="text-red-600 mt-2">‚ö† –•–æ–ª–æ–¥–Ω–æ!</p>');const ut=document.getElementById("physics-explanation");ut&&(ut.innerHTML=D)}function Bn(){const t=M.supplyT||70,e=document.getElementById("collector-temps"),o=document.getElementById("collector-explanation"),a=document.getElementById("particle-count-info");if(!e)return;let d="";for(let i=0;i<w;i++){const l=Qt[i]||20,n=mt[i]||20,f=l-n,r=dt(l,t,z.T_room_eq),p=de[i],m=Q==="bad"&&nt&&p>0&&f>2,u=m?"#ef4444":"#94a3b8";d+=`<div class="collector-temp-badge" style="background:rgba(${r.r},${r.g},${r.b},0.2);border:2px solid ${u};color:rgb(${r.r},${r.g},${r.b})">‚Ññ${i+1}: ${l.toFixed(1)}¬∞C ${m?"üî•":""}</div>`}if(e.innerHTML=d,o&&(Q==="bad"?o.innerHTML=nt?`<strong>–ë–µ–∑ —É–¥–ª–∏–Ω–∏—Ç–µ–ª—è + –ø—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–ö–õ:</strong> –ö–æ–ª–ª–µ–∫—Ç–æ—Ä –≥–æ—Ä—è—á–∏–π –æ—Ç —Å–µ–∫—Ü–∏–∏ 1 –¥–æ —Å–µ–∫—Ü–∏–∏ <strong>${zt+1}</strong>. –î–∞–ª—å—à–µ ‚Äî —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ —Å–µ–∫—Ü–∏–π.`:"<strong>–ë–µ–∑ —É–¥–ª–∏–Ω–∏—Ç–µ–ª—è + –ø—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫ –í–´–ö–õ:</strong> –ö–æ–ª–ª–µ–∫—Ç–æ—Ä –æ–±—Ä–∞—Ç–∫–∏ = —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥–æ–π —Å–µ–∫—Ü–∏–∏.":o.innerHTML=`<strong>–° —É–¥–ª–∏–Ω–∏—Ç–µ–ª–µ–º:</strong> –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–∞ –æ–±—Ä–∞—Ç–∫–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è ‚âà ${(Qt[0]||0).toFixed(1)}¬∞C`),a){let i="<strong>–ß–∞—Å—Ç–∏—Ü—ã –≤ –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–µ –æ–±—Ä–∞—Ç–∫–∏:</strong><br>";for(let l=0;l<w;l++)i+=`–°–µ–∫.${l+1}: ${de[l]} (–ø—Ä–æ—Ç–∏–≤–æ—Ç–æ–∫: ${Ne[l]}, –æ–±—Ä–∞—Ç–∫–∞: ${Qe[l]}) | `;a.innerHTML=i}}function Bo(t){ko(t);const e=document.getElementById("btn-bad"),o=document.getElementById("btn-good");e&&(e.className=Q==="bad"?"mode-btn mode-active px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-900 border-2 border-slate-300 shadow-sm":"mode-btn px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-600 border-2 border-slate-200"),o&&(o.className=Q==="good"?"mode-btn mode-active px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-900 border-2 border-slate-300 shadow-sm":"mode-btn px-4 py-2 rounded-xl text-sm font-semibold bg-white text-slate-600 border-2 border-slate-200"),st.forEach(a=>a.reset()),Ut()}function In(){Ho(!we);const t=document.getElementById("hydraulics-submenu"),e=document.getElementById("btn-hydraulics-menu");we?(t&&(t.style.display="flex"),e&&(e.innerHTML="üîΩ –°–∫—Ä—ã—Ç—å –º–µ–Ω—é",e.classList.add("ring-2","ring-slate-400"))):(t&&(t.style.display="none"),e&&(e.innerHTML="‚öô –ú–µ–Ω—é –ì–∏–¥—Ä–∞–≤–ª–∏–∫–∏",e.classList.remove("ring-2","ring-slate-400"))),R()}function Pn(){Xo(!Se);const t=document.getElementById("radiator-simulation-submenu"),e=document.getElementById("btn-radiator-simulation-menu");Se?(t&&(t.style.display="flex"),e&&(e.innerHTML="üîΩ –°–∫—Ä—ã—Ç—å –º–µ–Ω—é",e.classList.add("ring-2","ring-slate-400"))):(t&&(t.style.display="none"),e&&(e.innerHTML="üî• –ú–µ–Ω—é –°–∏–º—É–ª—è—Ü–∏–∏ –†–∞–¥–∏–∞—Ç–æ—Ä–∞",e.classList.remove("ring-2","ring-slate-400"))),R()}function $n(){Oo(!ce);const t=document.getElementById("balance-result"),e=document.getElementById("btn-balance");ce?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-amber-700"),e.classList.add("bg-amber-500","text-white","border-amber-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-amber-700"),e.classList.remove("bg-amber-500","text-white","border-amber-600"))),R()}function Ln(){zo(!Te);const t=document.getElementById("hydraulic-section"),e=document.getElementById("btn-resistance");Te?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-sky-700"),e.classList.add("bg-sky-500","text-white","border-sky-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-sky-700"),e.classList.remove("bg-sky-500","text-white","border-sky-600"))),R()}function Fn(){Ao(!_e);const t=document.getElementById("riser-calc-section"),e=document.getElementById("btn-riser");_e?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-purple-700"),e.classList.add("bg-purple-500","text-white","border-purple-600")),Bt()):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-purple-700"),e.classList.remove("bg-purple-500","text-white","border-purple-600"))),R()}function xn(){const t=document.getElementById("riser-info-section"),e=document.getElementById("btn-riser-info");if(!t||!e)return;const o=t.style.display!=="none";t.style.display=o?"none":"block",e.innerHTML=o?"üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è":"üîΩ –°–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é"}function Rn(){Vo(!Me);const t=document.getElementById("flow-dynamics-section"),e=document.getElementById("btn-flow-dynamics-menu");Me?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-pink-700"),e.classList.add("bg-pink-500","text-white","border-pink-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-pink-700"),e.classList.remove("bg-pink-500","text-white","border-pink-600"))),R()}function kn(){Wo(!Ce);const t=document.getElementById("visualization-section"),e=document.getElementById("btn-canvas");Ce?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-indigo-700"),e.classList.add("bg-indigo-500","text-white","border-indigo-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-indigo-700"),e.classList.remove("bg-indigo-500","text-white","border-indigo-600"))),R()}function Yn(){Do(!Ee);const t=document.getElementById("collector-section"),e=document.getElementById("btn-collector");Ee?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-orange-700"),e.classList.add("bg-orange-500","text-white","border-orange-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-orange-700"),e.classList.remove("bg-orange-500","text-white","border-orange-600"))),R()}function Hn(){Go(!Be);const t=document.getElementById("metrics-section"),e=document.getElementById("btn-metrics");Be?(t&&(t.style.display="flex"),e&&(e.classList.remove("bg-white","text-teal-700"),e.classList.add("bg-teal-500","text-white","border-teal-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-teal-700"),e.classList.remove("bg-teal-500","text-white","border-teal-600"))),R()}function zn(){No(!Ie);const t=document.getElementById("sections-section"),e=document.getElementById("btn-sections");Ie?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-violet-700"),e.classList.add("bg-violet-500","text-white","border-violet-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-violet-700"),e.classList.remove("bg-violet-500","text-white","border-violet-600"))),R()}function An(){Qo(!Pe);const t=document.getElementById("analysis-section"),e=document.getElementById("btn-analysis");Pe?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-slate-700"),e.classList.add("bg-slate-500","text-white","border-slate-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-slate-700"),e.classList.remove("bg-slate-500","text-white","border-slate-600"))),R()}function Xn(){je(!Ht);const t=document.getElementById("size-controls-section"),e=document.getElementById("btn-size-controls");Ht?(t&&(t.style.display="flex"),e&&(e.innerHTML="üîΩ –°–∫—Ä—ã—Ç—å —Ä–∞–∑–º–µ—Ä—ã",e.classList.add("ring-2","ring-slate-400"))):(t&&(t.style.display="none"),e&&(e.innerHTML="üìê –†–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏—è",e.classList.remove("ring-2","ring-slate-400"))),R()}function On(){const t=document.getElementById("six-rad-size-controls-section"),e=document.getElementById("btn-six-rad-size-controls");if(!t||!e)return;const o=t.style.display!=="none";t.style.display=o?"none":"flex",e.innerHTML=o?"üìê –†–∞–∑–º–µ—Ä—ã –∏ –ø–æ–∑–∏—Ü–∏—è":"üîΩ –°–∫—Ä—ã—Ç—å —Ä–∞–∑–º–µ—Ä—ã",e.classList.toggle("ring-2",!o),e.classList.toggle("ring-purple-400",!o)}function Vn(t,e){const o=Math.max(0,Math.min(100,Number(e)||100));xe(t,o);const a=document.getElementById(`six-rad-bypass-${t}`),d=document.getElementById(`six-rad-bypass-val-${t}`);a&&(a.value=String(Math.round(o))),d&&(d.textContent=`${Math.round(o)}%`),R()}function Wn(){for(let t=0;t<6;t++){xe(t,100);const e=document.getElementById(`six-rad-bypass-${t}`),o=document.getElementById(`six-rad-bypass-val-${t}`);e&&(e.value="100"),o&&(o.textContent="100%")}Bt(),R()}function Dn(){for(let t=0;t<6;t++){xe(t,0);const e=document.getElementById(`six-rad-bypass-${t}`),o=document.getElementById(`six-rad-bypass-val-${t}`);e&&(e.value="0"),o&&(o.textContent="0%")}Bt(),R()}function Gn(t){no(Dt+t);const e=document.getElementById("six-rad-canvas-width");e&&(e.value=String(Dt)),gt(),R()}function Nn(){const t=document.getElementById("six-rad-canvas-width"),e=parseInt((t==null?void 0:t.value)||"1600")||1600;no(e),t&&(t.value=String(Dt)),gt(),R()}function Qn(t){ao(Gt+t);const e=document.getElementById("six-rad-canvas-height");e&&(e.value=String(Gt)),gt(),R()}function Kn(){const t=document.getElementById("six-rad-canvas-height"),e=parseInt((t==null?void 0:t.value)||"850")||850;ao(e),t&&(t.value=String(Gt)),gt(),R()}function qn(t){io(Nt+t);const e=document.getElementById("six-rad-view-scale");e&&(e.value=String(Nt)),R()}function jn(){const t=document.getElementById("six-rad-view-scale"),e=parseFloat((t==null?void 0:t.value)||"1.15")||1.15;io(e),t&&(t.value=String(Nt)),R()}function Un(){Ko(!$e);const t=document.getElementById("section-controls-section"),e=document.getElementById("btn-section-controls");$e?(t&&(t.style.display="block"),e&&(e.classList.remove("bg-white","text-sky-700"),e.classList.add("bg-sky-500","text-white","border-sky-600"))):(t&&(t.style.display="none"),e&&(e.classList.add("bg-white","text-sky-700"),e.classList.remove("bg-sky-500","text-white","border-sky-600"))),R()}function Jn(t,e){t==="width"?(Ue(_t+e),document.getElementById("rad-width").value=String(_t)):(Je(St+e),document.getElementById("rad-height").value=String(St)),rs()}function Zn(t,e){t==="x"?(Ze(Mt+e),document.getElementById("rad-pos-x").value=String(Mt)):(to(Ct+e),document.getElementById("rad-pos-y").value=String(Ct)),ds()}function rs(){const t=document.getElementById("rad-width"),e=document.getElementById("rad-height"),o=Math.max(400,Math.min(1400,parseInt((t==null?void 0:t.value)||"1240")||1240)),a=Math.max(200,Math.min(600,parseInt((e==null?void 0:e.value)||"360")||360));Ue(o),Je(a),t&&(t.value=String(_t)),e&&(e.value=String(St)),Fe(_t,St,Mt,Ct),st.forEach(d=>d.reset()),R()}function ta(t){eo(ft+t);const e=document.getElementById("left-pipe-ext"),o=document.getElementById("left-pipe-ext-val");e&&(e.value=String(ft)),o&&(o.textContent=String(ft)),R()}function ea(){const t=document.getElementById("left-pipe-ext"),e=parseInt((t==null?void 0:t.value)||"0")||0;eo(e);const o=document.getElementById("left-pipe-ext-val");o&&(o.textContent=String(ft)),R()}function oa(t){so(wt+t);const e=document.getElementById("canvas-width");e&&(e.value=String(wt));const o=document.getElementById("simCanvas");o&&(o.width=wt),gt(),R()}function sa(){const t=document.getElementById("canvas-width"),e=parseInt((t==null?void 0:t.value)||"1600")||1600;so(e),t&&(t.value=String(wt));const o=document.getElementById("simCanvas");o&&(o.width=wt),gt(),R()}function na(t){oo(vt+t);const e=document.getElementById("canvas-height");e&&(e.value=String(vt));const o=document.getElementById("simCanvas");o&&(o.height=vt),gt(),R()}function aa(){const t=document.getElementById("canvas-height"),e=parseInt((t==null?void 0:t.value)||"850")||850;oo(e),t&&(t.value=String(vt));const o=document.getElementById("simCanvas");o&&(o.height=vt),gt(),R()}function ds(){const t=document.getElementById("rad-pos-x"),e=document.getElementById("rad-pos-y"),o=Math.max(285,Math.min(600,parseInt((t==null?void 0:t.value)||"300")||300)),a=Math.max(100,Math.min(400,parseInt((e==null?void 0:e.value)||"260")||260));Ze(o),to(a),t&&(t.value=String(Mt)),e&&(e.value=String(Ct)),Fe(_t,St,Mt,Ct),st.forEach(d=>d.reset()),R()}function ia(){const t=document.getElementById("section-controls");if(t){t.innerHTML="";for(let e=0;e<w;e++){const o=document.createElement("div");o.className="text-center",o.innerHTML=`<div class="text-xs text-slate-500 mb-2">‚Ññ${e+1}</div><input type="range" min="0" max="100" value="100" class="w-full" id="slider-${e}"><div class="text-sm font-mono mt-2 text-slate-700" id="value-${e}">100%</div>`,t.appendChild(o),o.querySelector("input").addEventListener("input",function(){ct[e]=Number(this.value)/100;const a=document.getElementById(`value-${e}`);a&&(a.textContent=`${this.value}%`),as(),st.forEach(d=>d.reset())})}}}function la(){const t=document.getElementById("heat-loss-coeff"),e=document.getElementById("particles-per-liter"),o=document.getElementById("gravity-force");t&&t.addEventListener("input",le),e&&e.addEventListener("input",()=>{le(),is()}),o&&o.addEventListener("input",le)}function ra(){const t=M.supplyT,e=M.nomPower,o=M.outsideT,a=M.Kroom;M.Qint;const d=M.sysFlowLPM;M.sysFlowKGS,M.hA_section;const i=z.T_room_eq;M.heatLossDesign,M.designOutTemp;const l=M.totalPower/e*100;t-M.avgRetTemp;let n=`‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë     –ü–û–õ–ù–´–ô –¢–ï–ü–õ–û–í–û–ô –†–ê–°–ß–Å–¢ –†–ê–î–ò–ê–¢–û–†–ù–û–ô –°–ò–°–¢–ï–ú–´ –û–¢–û–ü–õ–ï–ù–ò–Ø            ‚ïë
‚ïë  –ú–µ—Ç–æ–¥: Œµ-NTU + –∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–≤–Ω–æ–≤–µ—Å–Ω–æ–π T_room (–ù—å—é—Ç–æ–Ω-–†–∞—Ñ—Å–æ–Ω) ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

`;return n+=`–î–∞—Ç–∞ —Ä–∞—Å—á—ë—Ç–∞: ${new Date().toLocaleString("ru-RU")}
–†–µ–∂–∏–º: ${Q==="good"?"–° —É–¥–ª–∏–Ω–∏—Ç–µ–ª–µ–º –ø–æ—Ç–æ–∫–∞":"–ë–µ–∑ —É–¥–ª–∏–Ω–∏—Ç–µ–ª—è (Œ±="+gs+")"}
–ö—Ä–∞–Ω –±–∞–π–ø–∞—Å–∞: ${Tt}% –æ—Ç–∫—Ä—ã—Ç

`,n+=`–†–ê–î–ò–ê–¢–û–†: Q_–Ω–æ–º=${e}–í—Ç, N=${w}, T_–ø–æ–¥–∞—á–∏=${t}¬∞C, T_—É–ª=${o}¬∞C, —Ä–∞—Å—Ö–æ–¥=${d.toFixed(2)} –ª/–º–∏–Ω
`,n+=`T_room —Ä–∞–≤–Ω–æ–≤–µ—Å–Ω–∞—è: ${i.toFixed(2)}¬∞C, K_room=${a.toFixed(2)} –í—Ç/–ö
`,n+=`–ë–∞–ª–∞–Ω—Å: Q_—Ä–∞–¥=${M.totalPower.toFixed(0)} –í—Ç = Q_–ø–æ—Ç–µ—Ä—å=${z.Q_loss.toFixed(0)} –í—Ç (K√ó(T_–∫–æ–º–Ω‚àíT_—É–ª)‚àíQ_–∏–Ω—Ç, ${l.toFixed(1)}% –Ω–æ–º–∏–Ω–∞–ª–∞)
`,n+=`–ë–∞–π–ø–∞—Å: ${(X.bypassFrac*100).toFixed(1)}%, –†–∞–¥–∏–∞—Ç–æ—Ä: ${(X.radFrac*100).toFixed(1)}%
`,n}function da(){const t=ra(),e=new Blob([t],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(e),a=document.createElement("a");a.href=o,a.download=`thermal_report_${new Date().toISOString().slice(0,16).replace(/:/g,"-")}.txt`,a.click(),URL.revokeObjectURL(o)}function ca(){const t=document.getElementById("simCanvas");if(!t){console.error("Canvas #simCanvas not found");return}t.width=wt,t.height=vt,Fs(t),gt();for(let e=0;e<1e3;e++)st.push(new qo);ia(),la(),window.setMode=Bo,window.toggleCounterflow=Tn,window.toggleHydraulicsMenu=In,window.toggleRadiatorSimulationMenu=Pn,window.toggleBalance=$n,window.toggleFlowDynamics=Rn,window.toggleCanvas=kn,window.adjustRadSize=Jn,window.applyRadSize=rs,window.adjustRadPos=Zn,window.applyRadPos=ds,window.adjustLeftPipeExt=ta,window.applyLeftPipeExt=ea,window.adjustCanvasWidth=oa,window.applyCanvasWidth=sa,window.adjustCanvasHeight=na,window.applyCanvasHeight=aa,window.toggleCollector=Yn,window.toggleMetrics=Hn,window.toggleSections=zn,window.toggleAnalysis=An,window.toggleSectionControls=Un,window.toggleSizeControls=Xn,window.toggleSixRadSizeControls=On,window.adjustSixRadCanvasWidth=Gn,window.adjustSixRadCanvasHeight=Qn,window.applySixRadCanvasWidth=Nn,window.applySixRadCanvasHeight=Kn,window.adjustSixRadViewScale=qn,window.applySixRadViewScale=jn,window.toggleResistance=Ln,window.toggleRiser=Fn,window.toggleRiserInfo=xn,window.recalcAll=Ut,window.thawAll=Cn,window.debouncedRecalc=as,window.updateBypassDisplay=wn,window.updateHydroParams=mo,window.resetHydroParams=_n,window.riserOpenAll=Vs,window.riserCloseAll=Ws,window.riserCloseOne=Ds,window.toggleRiserBypass=Gs,window.setSixRadBypassPct=Vn,window.sixRadBypassAllOpen=Wn,window.sixRadBypassAllClosed=Dn,window.calcRiser=Bt,window.downloadFullReport=da,window.saveSettings=R,vn(),Fe(_t,St,Mt,Ct),Bo(Q),Bt(),le(),ls()}ca();
